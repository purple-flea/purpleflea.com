<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rate Limits ‚Äî Purple Flea API</title>
<meta name="description" content="Purple Flea API rate limits by tier, per-endpoint limits, burst allowance, and best practices for autonomous agents. Free, Pro, and Enterprise tiers.">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://purpleflea.com/rate-limits">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üü£</text></svg>">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://purpleflea.com/rate-limits">
<meta property="og:title" content="Rate Limits ‚Äî Purple Flea API">
<meta property="og:description" content="High-throughput APIs built for autonomous agents. Rate limit tiers, per-endpoint limits, burst allowance, and agent best practices.">
<meta property="og:image" content="https://purpleflea.com/flea.jpg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Rate Limits ‚Äî Purple Flea API">
<meta name="twitter:description" content="High-throughput APIs built for autonomous agents. Free, Pro, and Enterprise rate limit tiers.">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "name": "Purple Flea API Rate Limits",
  "url": "https://purpleflea.com/rate-limits",
  "description": "Rate limit documentation for Purple Flea APIs: tiers, per-endpoint limits, headers, and best practices for autonomous agents.",
  "author": {"@type": "Organization", "name": "Purple Flea", "url": "https://purpleflea.com"},
  "publisher": {"@type": "Organization", "name": "Purple Flea", "url": "https://purpleflea.com"}
}
</script>

<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --purple: #A855F7;
  --purple-dim: #7C3AED;
  --purple-glow: rgba(168, 85, 247, 0.2);
  --bg: #09090B;
  --bg-sidebar: #0D0D10;
  --bg-card: rgba(255, 255, 255, 0.03);
  --bg-card-hover: rgba(255, 255, 255, 0.05);
  --border: rgba(255, 255, 255, 0.06);
  --border-purple: rgba(168, 85, 247, 0.25);
  --text: #FAFAFA;
  --text-secondary: #A1A1AA;
  --text-muted: #71717A;
  --green: #22C55E;
  --blue: #60A5FA;
  --amber: #F59E0B;
  --red: #F87171;
  --radius: 12px;
  --mono: 'JetBrains Mono', 'Fira Code', monospace;
  --sidebar-width: 260px;
}

html { scroll-behavior: smooth; }

body {
  font-family: 'Inter', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  display: flex;
  min-height: 100vh;
}

::-webkit-scrollbar { width: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(168,85,247,0.25); border-radius: 3px; }

/* Sidebar */
.sidebar {
  width: var(--sidebar-width);
  flex-shrink: 0;
  background: var(--bg-sidebar);
  border-right: 1px solid var(--border);
  height: 100vh;
  position: sticky;
  top: 0;
  overflow-y: auto;
  padding: 20px 0 40px;
}
.sidebar-logo {
  display: flex; align-items: center; gap: 8px;
  padding: 0 20px 20px;
  border-bottom: 1px solid var(--border);
  text-decoration: none; color: var(--text);
  font-weight: 700; font-size: 0.95rem;
}
.sidebar-logo-icon { color: var(--purple); font-size: 1.1rem; }
.sidebar-section {
  padding: 20px 20px 8px;
  font-size: 0.65rem; font-weight: 700; letter-spacing: 0.12em;
  text-transform: uppercase; color: var(--text-muted);
}
.sidebar-link {
  display: block; padding: 7px 20px;
  font-size: 0.825rem; color: var(--text-secondary);
  text-decoration: none; border-left: 2px solid transparent;
  transition: all 0.15s;
}
.sidebar-link:hover { color: var(--text); background: rgba(255,255,255,0.03); }
.sidebar-link.active {
  color: var(--purple); border-left-color: var(--purple);
  background: rgba(168,85,247,0.06);
}
.sidebar-link.sub { padding-left: 32px; font-size: 0.78rem; }

/* Main content */
.main {
  flex: 1;
  min-width: 0;
  max-width: 800px;
  padding: 48px 48px 80px;
}
@media (max-width: 768px) {
  body { flex-direction: column; }
  .sidebar { width: 100%; height: auto; position: static; }
  .main { padding: 24px 20px 60px; }
}

/* Typography */
h1 { font-size: 2rem; font-weight: 800; letter-spacing: -0.04em; line-height: 1.15; margin-bottom: 16px; }
h2 { font-size: 1.4rem; font-weight: 700; letter-spacing: -0.03em; margin: 40px 0 14px; padding-top: 20px; border-top: 1px solid var(--border); }
h2:first-child { border-top: none; padding-top: 0; margin-top: 0; }
h3 { font-size: 1.05rem; font-weight: 600; letter-spacing: -0.02em; margin: 28px 0 10px; color: var(--text); }
p { color: var(--text-secondary); margin-bottom: 14px; font-size: 0.925rem; }
p:last-child { margin-bottom: 0; }
a { color: var(--purple); text-decoration: none; }
a:hover { text-decoration: underline; }
ul, ol { color: var(--text-secondary); margin: 12px 0 16px 20px; font-size: 0.9rem; }
li { margin-bottom: 6px; }
strong { color: var(--text); font-weight: 600; }
code {
  font-family: var(--mono); font-size: 0.82em;
  background: rgba(168,85,247,0.1); color: var(--purple);
  padding: 1px 5px; border-radius: 4px;
}

/* Page intro */
.page-intro {
  padding-bottom: 32px; margin-bottom: 12px;
  border-bottom: 1px solid var(--border);
}
.page-tag {
  display: inline-flex; align-items: center; gap: 6px;
  background: rgba(168,85,247,0.1); border: 1px solid var(--border-purple);
  color: var(--purple); font-size: 0.72rem; font-weight: 600;
  padding: 3px 10px; border-radius: 20px; margin-bottom: 16px;
  text-transform: uppercase; letter-spacing: 0.06em;
}

/* Code block */
.code-block {
  background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.07);
  border-radius: var(--radius); padding: 18px 20px;
  font-family: var(--mono); font-size: 0.8rem; color: #D4D4D8;
  white-space: pre; overflow-x: auto; margin: 14px 0 20px;
  position: relative; line-height: 1.6;
}
.code-block .comment { color: var(--text-muted); }
.code-block .string { color: #86EFAC; }
.code-block .keyword { color: #C084FC; }
.code-block .number { color: #FCA5A5; }
.code-block .url { color: #67E8F9; }
.copy-btn {
  position: absolute; top: 10px; right: 10px;
  background: rgba(168,85,247,0.15); border: 1px solid var(--border-purple);
  color: var(--purple); font-size: 0.68rem; font-weight: 600;
  padding: 3px 10px; border-radius: 6px; cursor: pointer;
  font-family: 'Inter', sans-serif; transition: background 0.15s;
}
.copy-btn:hover { background: rgba(168,85,247,0.28); }

/* Param table */
.param-table {
  width: 100%; border-collapse: collapse;
  font-size: 0.82rem; margin: 12px 0 20px;
}
.param-table th {
  text-align: left; padding: 8px 12px;
  color: var(--text-muted); font-weight: 500; font-size: 0.72rem;
  border-bottom: 1px solid var(--border);
  text-transform: uppercase; letter-spacing: 0.06em;
}
.param-table td {
  padding: 10px 12px; border-bottom: 1px solid rgba(255,255,255,0.03);
  color: var(--text-secondary); vertical-align: top;
}
.param-table td:first-child { color: var(--text); font-family: var(--mono); font-size: 0.78rem; }
.param-table td.type { color: var(--amber); font-family: var(--mono); font-size: 0.75rem; }
.param-table td.limit { color: var(--blue); font-family: var(--mono); font-size: 0.78rem; font-weight: 600; }
.param-table td.unlimited { color: var(--green); font-family: var(--mono); font-size: 0.78rem; font-weight: 600; }
.param-table td.note { color: var(--amber); font-family: var(--mono); font-size: 0.75rem; }
.param-table tr:last-child td { border-bottom: none; }

/* Tier badge */
.tier-badge {
  display: inline-block; font-size: 0.7rem; font-weight: 700;
  padding: 2px 9px; border-radius: 20px; vertical-align: middle;
}
.tier-free { background: rgba(113,113,122,0.15); color: var(--text-muted); border: 1px solid rgba(113,113,122,0.3); }
.tier-pro { background: rgba(168,85,247,0.12); color: var(--purple); border: 1px solid var(--border-purple); }
.tier-enterprise { background: rgba(34,197,94,0.1); color: var(--green); border: 1px solid rgba(34,197,94,0.25); }

/* Callout boxes */
.callout {
  border-radius: var(--radius); padding: 14px 18px;
  margin: 16px 0; font-size: 0.875rem;
  display: flex; gap: 12px; align-items: flex-start;
}
.callout-info { background: rgba(96,165,250,0.07); border: 1px solid rgba(96,165,250,0.2); }
.callout-success { background: rgba(34,197,94,0.07); border: 1px solid rgba(34,197,94,0.2); }
.callout-warning { background: rgba(245,158,11,0.07); border: 1px solid rgba(245,158,11,0.2); }
.callout-purple { background: rgba(168,85,247,0.07); border: 1px solid var(--border-purple); }
.callout-icon { font-size: 1rem; flex-shrink: 0; margin-top: 1px; }
.callout p { color: var(--text-secondary); margin: 0; font-size: 0.85rem; }
.callout strong { color: var(--text); }

/* Breadcrumb */
.breadcrumb {
  display: flex; gap: 8px; align-items: center;
  font-size: 0.78rem; color: var(--text-muted); margin-bottom: 20px;
}
.breadcrumb a { color: var(--text-muted); text-decoration: none; }
.breadcrumb a:hover { color: var(--purple); }
.breadcrumb span { color: var(--text-secondary); }

/* Header row */
.header-row {
  display: flex; align-items: center; gap: 12px;
  margin-bottom: 4px;
}
.header-icon {
  width: 40px; height: 40px; border-radius: 10px;
  background: rgba(168,85,247,0.12); border: 1px solid var(--border-purple);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.2rem; flex-shrink: 0;
}

/* Step list */
.steps { margin: 14px 0 20px; display: flex; flex-direction: column; gap: 10px; }
.step {
  display: flex; gap: 14px; align-items: flex-start;
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: 9px; padding: 14px 16px;
}
.step-num {
  width: 24px; height: 24px; border-radius: 50%; flex-shrink: 0;
  background: rgba(168,85,247,0.15); border: 1px solid var(--border-purple);
  color: var(--purple); font-size: 0.72rem; font-weight: 700;
  display: flex; align-items: center; justify-content: center;
  margin-top: 1px;
}
.step-body { flex: 1; min-width: 0; }
.step-title { font-size: 0.9rem; font-weight: 600; color: var(--text); margin-bottom: 4px; }
.step-desc { font-size: 0.82rem; color: var(--text-secondary); }
</style>
</head>
<body>

<!-- Sidebar -->
<aside class="sidebar">
  <a href="/" class="sidebar-logo">
    <span class="sidebar-logo-icon">&#9830;</span>
    Purple Flea
  </a>

  <div class="sidebar-section">Rate Limits</div>
  <a href="#tiers" class="sidebar-link active">Tiers Overview</a>
  <a href="#per-endpoint" class="sidebar-link sub">Per-Endpoint Limits</a>
  <a href="#burst" class="sidebar-link sub">Burst Allowance</a>
  <a href="#headers" class="sidebar-link">Response Headers</a>
  <a href="#429" class="sidebar-link sub">429 Response</a>
  <a href="#best-practices" class="sidebar-link">Agent Best Practices</a>
  <a href="#backoff-code" class="sidebar-link sub">Backoff Code</a>
  <a href="#upgrade" class="sidebar-link">Upgrade</a>

  <div class="sidebar-section">Docs</div>
  <a href="/docs" class="sidebar-link">API Reference</a>
  <a href="/security" class="sidebar-link">Security</a>
  <a href="/quick-start" class="sidebar-link">Quick Start</a>
  <a href="/for-agents" class="sidebar-link">For Agents</a>

  <div class="sidebar-section">Links</div>
  <a href="https://purpleflea.com" class="sidebar-link">‚Üê purpleflea.com</a>
  <a href="/llms.txt" class="sidebar-link">llms.txt</a>
  <a href="https://github.com/purple-flea" target="_blank" class="sidebar-link">GitHub ‚Üó</a>
</aside>

<!-- Main -->
<main class="main">

  <div class="page-intro">
    <div class="breadcrumb">
      <a href="/">purpleflea.com</a>
      <span>/</span>
      <span>rate-limits</span>
    </div>
    <div class="page-tag">Infrastructure</div>
    <h1>Rate Limits</h1>
    <p>High-throughput APIs built for autonomous agents. Purple Flea enforces per-minute and per-day limits by tier, with burst headroom and sensible per-endpoint caps for integrity-sensitive operations.</p>
  </div>

  <!-- Tiers -->
  <section id="tiers">
    <h2>Rate Limit Tiers</h2>
    <p>All new registrations start on the Free tier. Limits apply per API key across all endpoints unless otherwise noted.</p>

    <table class="param-table">
      <thead>
        <tr>
          <th>Tier</th>
          <th>Requests / min</th>
          <th>Requests / day</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span class="tier-badge tier-free">Free</span></td>
          <td class="limit">100</td>
          <td class="limit">10,000</td>
          <td>Default for all new API keys</td>
        </tr>
        <tr>
          <td><span class="tier-badge tier-pro">Pro</span></td>
          <td class="limit">1,000</td>
          <td class="limit">1,000,000</td>
          <td>Contact <a href="mailto:hello@purpleflea.com">hello@purpleflea.com</a></td>
        </tr>
        <tr>
          <td><span class="tier-badge tier-enterprise">Enterprise</span></td>
          <td class="unlimited">Unlimited</td>
          <td class="unlimited">Unlimited</td>
          <td>SLA available, dedicated infrastructure</td>
        </tr>
      </tbody>
    </table>

    <div class="callout callout-info">
      <span class="callout-icon">&#9432;</span>
      <p><strong>Counting:</strong> Every HTTP request counts against your limit regardless of outcome ‚Äî including 400, 401, and 404 responses. Failed requests still consume quota.</p>
    </div>

    <section id="per-endpoint">
      <h3>Per-Endpoint Limits</h3>
      <p>Some endpoints carry additional per-minute caps independent of your tier limit. These apply on top of the tier ceiling ‚Äî whichever limit is lower takes precedence.</p>

      <table class="param-table">
        <thead>
          <tr>
            <th>Endpoint</th>
            <th>Hard Cap (req/min)</th>
            <th>Reason</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Casino <code>/play</code></td>
            <td class="limit">60</td>
            <td>Game integrity ‚Äî one bet per second max</td>
          </tr>
          <tr>
            <td>Trading <code>/positions</code></td>
            <td class="limit">300</td>
            <td>Order book access, risk management polling</td>
          </tr>
          <tr>
            <td>Wallet <code>/swap</code></td>
            <td class="limit">120</td>
            <td>DEX aggregator upstream limits</td>
          </tr>
          <tr>
            <td>All <code>/register</code> endpoints</td>
            <td class="note">10</td>
            <td>Anti-spam, account creation throttle</td>
          </tr>
        </tbody>
      </table>

      <div class="callout callout-warning">
        <span class="callout-icon">&#9888;</span>
        <p><strong>/register endpoints are IP-limited, not key-limited.</strong> The 10 req/min cap applies per originating IP address, even if the requests use different API keys. This is intentional anti-abuse behavior that cannot be bypassed with Pro or Enterprise tiers.</p>
      </div>
    </section>

    <section id="burst">
      <h3>Burst Allowance</h3>
      <p>Purple Flea allows short traffic spikes using a token bucket algorithm. You may exceed your per-minute limit by up to <strong>3x for a 10-second burst window</strong> before requests are rate-limited.</p>

      <table class="param-table">
        <thead>
          <tr>
            <th>Tier</th>
            <th>Sustained (req/min)</th>
            <th>Burst Peak (req/10s)</th>
            <th>Burst Multiplier</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="tier-badge tier-free">Free</span></td>
            <td class="limit">100</td>
            <td class="limit">50</td>
            <td>3x for 10s</td>
          </tr>
          <tr>
            <td><span class="tier-badge tier-pro">Pro</span></td>
            <td class="limit">1,000</td>
            <td class="limit">500</td>
            <td>3x for 10s</td>
          </tr>
          <tr>
            <td><span class="tier-badge tier-enterprise">Enterprise</span></td>
            <td class="unlimited">Unlimited</td>
            <td class="unlimited">Unlimited</td>
            <td>‚Äî</td>
          </tr>
        </tbody>
      </table>

      <p>After a burst window, the bucket refills at the sustained rate. Burst is useful for initialization sequences (fetching market state on startup) but should not be relied upon for steady-state operation.</p>
    </section>
  </section>

  <!-- Headers -->
  <section id="headers">
    <h2>Rate Limit Headers</h2>
    <p>Every API response includes rate limit state in the following headers. Agents should read these on every response to avoid hitting limits.</p>

    <table class="param-table">
      <thead>
        <tr>
          <th>Header</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>X-RateLimit-Limit</td>
          <td class="type">integer</td>
          <td>Maximum requests allowed in the current window</td>
        </tr>
        <tr>
          <td>X-RateLimit-Remaining</td>
          <td class="type">integer</td>
          <td>Requests remaining in the current window</td>
        </tr>
        <tr>
          <td>X-RateLimit-Reset</td>
          <td class="type">unix timestamp</td>
          <td>UTC timestamp when the current window resets</td>
        </tr>
        <tr>
          <td>Retry-After</td>
          <td class="type">integer</td>
          <td>Seconds to wait before retrying (only on 429 responses)</td>
        </tr>
      </tbody>
    </table>

    <div class="code-block">HTTP/1.1 200 OK
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 73
X-RateLimit-Reset: 1735689600
Content-Type: application/json</div>

    <section id="429">
      <h3>429 Response Format</h3>
      <p>When a rate limit is exceeded, the API returns HTTP 429 with a JSON body describing the limit that was hit and when to retry.</p>

      <div class="code-block" id="429-example"><button class="copy-btn" onclick="copyBlock('429-example',this)">Copy</button>HTTP/1.1 429 Too Many Requests
Retry-After: 14
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1735689614
Content-Type: application/json

<span class="string">{
  "error": "rate_limit_exceeded",
  "message": "Too many requests. You have exceeded the 100 req/min limit for your tier.",
  "limit": 100,
  "window": "1m",
  "retry_after_seconds": 14,
  "reset_at": "2025-12-31T12:00:14Z",
  "tier": "free",
  "upgrade_url": "https://purpleflea.com/pricing"
}</span></div>

      <div class="callout callout-info">
        <span class="callout-icon">&#9432;</span>
        <p><strong>Always use Retry-After.</strong> Do not hardcode sleep durations. The <code>Retry-After</code> header gives the exact number of seconds until your window resets. Use it directly in your backoff logic.</p>
      </div>
    </section>
  </section>

  <!-- Best Practices -->
  <section id="best-practices">
    <h2>Best Practices for Agents</h2>
    <p>Autonomous agents that run continuously need to be rate-limit-aware by design, not as an afterthought. The following patterns keep agents within limits without sacrificing responsiveness.</p>

    <div class="steps">
      <div class="step">
        <div class="step-num">1</div>
        <div class="step-body">
          <div class="step-title">Use exponential backoff on 429s</div>
          <div class="step-desc">When you receive a 429, wait <code>Retry-After</code> seconds before retrying. If you receive consecutive 429s, multiply the wait by 2 each time (capped at 60s). Do not retry immediately.</div>
        </div>
      </div>
      <div class="step">
        <div class="step-num">2</div>
        <div class="step-body">
          <div class="step-title">Cache market data aggressively</div>
          <div class="step-desc">Poll <code>GET /v1/markets</code> at most every 5 seconds. Market data changes rarely enough that sub-second polling wastes quota with no benefit. Store the last response in memory and serve it locally between polls.</div>
        </div>
      </div>
      <div class="step">
        <div class="step-num">3</div>
        <div class="step-body">
          <div class="step-title">Batch operations where possible</div>
          <div class="step-desc">Fetch multiple positions, balances, or history entries in a single paginated call rather than one call per item. Use <code>limit</code> query parameters to retrieve up to 100 records at once.</div>
        </div>
      </div>
      <div class="step">
        <div class="step-num">4</div>
        <div class="step-body">
          <div class="step-title">Track X-RateLimit-Remaining proactively</div>
          <div class="step-desc">If <code>X-RateLimit-Remaining</code> drops below 10, introduce a short sleep before the next request rather than waiting for a 429. Pre-emptive throttling prevents errors entirely.</div>
        </div>
      </div>
      <div class="step">
        <div class="step-num">5</div>
        <div class="step-body">
          <div class="step-title">Do not use burst for polling loops</div>
          <div class="step-desc">Burst headroom is intended for initialization sequences and occasional spikes. Running a polling loop at burst speed will exhaust the burst budget immediately and then hit sustained limits.</div>
        </div>
      </div>
    </div>

    <section id="backoff-code">
      <h3>Python: Rate-Limit-Aware Request Handler</h3>
      <p>Drop-in wrapper that handles 429 responses with exponential backoff, reads <code>Retry-After</code>, and pre-emptively slows down when remaining quota is low.</p>

      <div class="code-block" id="backoff-py"><button class="copy-btn" onclick="copyBlock('backoff-py',this)">Copy</button"><span class="keyword">import</span> time
<span class="keyword">import</span> requests
<span class="keyword">from</span> typing <span class="keyword">import</span> Any, Dict, Optional

<span class="keyword">class</span> <span class="url">PurpleFl–µaClient</span>:
    <span class="string">"""Rate-limit-aware client for Purple Flea APIs."""</span>

    BASE_URL = <span class="string">"https://api.purpleflea.com"</span>
    MAX_RETRIES = <span class="number">5</span>
    BACKOFF_BASE = <span class="number">2</span>   <span class="comment"># seconds, doubles on each retry</span>
    BACKOFF_MAX  = <span class="number">60</span>  <span class="comment"># cap at 60 seconds</span>
    LOW_QUOTA_THRESHOLD = <span class="number">10</span>  <span class="comment"># slow down below this remaining count</span>

    <span class="keyword">def</span> <span class="url">__init__</span>(self, api_key: str):
        self.session = requests.Session()
        self.session.headers.update({
            <span class="string">"Authorization"</span>: f<span class="string">"Bearer {api_key}"</span>,
            <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>,
        })
        self._remaining = <span class="keyword">None</span>
        self._reset_at  = <span class="keyword">None</span>

    <span class="keyword">def</span> <span class="url">_update_quota</span>(self, response: requests.Response) -> <span class="keyword">None</span>:
        <span class="string">"""Parse rate limit headers from every response."""</span>
        self._remaining = <span class="url">int</span>(response.headers.get(<span class="string">"X-RateLimit-Remaining"</span>, <span class="number">999</span>))
        reset_ts = response.headers.get(<span class="string">"X-RateLimit-Reset"</span>)
        <span class="keyword">if</span> reset_ts:
            self._reset_at = <span class="url">float</span>(reset_ts)

    <span class="keyword">def</span> <span class="url">_maybe_throttle</span>(self) -> <span class="keyword">None</span>:
        <span class="string">"""Pre-emptively sleep if quota is nearly exhausted."""</span>
        <span class="keyword">if</span> self._remaining <span class="keyword">is not None</span> <span class="keyword">and</span> self._remaining < self.LOW_QUOTA_THRESHOLD:
            <span class="keyword">if</span> self._reset_at:
                wait = max(<span class="number">0</span>, self._reset_at - time.time())
                <span class="keyword">if</span> wait > <span class="number">0</span>:
                    time.sleep(wait)

    <span class="keyword">def</span> <span class="url">request</span>(
        self,
        method: str,
        path: str,
        **kwargs
    ) -> Dict[str, Any]:
        <span class="string">"""Make an API request with automatic retry + backoff on 429."""</span>
        url = f<span class="string">"{self.BASE_URL}{path}"</span>
        backoff = self.BACKOFF_BASE

        <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="url">range</span>(self.MAX_RETRIES):
            self._maybe_throttle()

            resp = self.session.request(method, url, **kwargs)
            self._update_quota(resp)

            <span class="keyword">if</span> resp.status_code == <span class="number">429</span>:
                retry_after = <span class="url">int</span>(resp.headers.get(<span class="string">"Retry-After"</span>, backoff))
                wait = min(retry_after, self.BACKOFF_MAX)
                <span class="keyword">print</span>(f<span class="string">"Rate limited. Waiting {wait}s (attempt {attempt + 1}/{self.MAX_RETRIES})"</span>)
                time.sleep(wait)
                backoff = min(backoff * <span class="number">2</span>, self.BACKOFF_MAX)
                <span class="keyword">continue</span>

            resp.raise_for_status()
            <span class="keyword">return</span> resp.json()

        <span class="keyword">raise</span> <span class="url">RuntimeError</span>(f<span class="string">"Max retries exceeded for {method} {path}"</span>)

    <span class="keyword">def</span> <span class="url">get</span>(self, path: str, **kwargs) -> Dict[str, Any]:
        <span class="keyword">return</span> self.request(<span class="string">"GET"</span>, path, **kwargs)

    <span class="keyword">def</span> <span class="url">post</span>(self, path: str, **kwargs) -> Dict[str, Any]:
        <span class="keyword">return</span> self.request(<span class="string">"POST"</span>, path, **kwargs)


<span class="comment"># Usage</span>
client = <span class="url">PurpleFl–µaClient</span>(api_key=<span class="string">"sk_live_..."</span>)

<span class="comment"># Cache markets locally ‚Äî poll at most every 5 seconds</span>
<span class="keyword">import</span> threading

_market_cache = {<span class="string">"data"</span>: <span class="keyword">None</span>, <span class="string">"ts"</span>: <span class="number">0</span>}
_cache_lock = threading.Lock()

<span class="keyword">def</span> <span class="url">get_markets</span>() -> Dict[str, Any]:
    <span class="keyword">with</span> _cache_lock:
        <span class="keyword">if</span> time.time() - _market_cache[<span class="string">"ts"</span>] < <span class="number">5</span>:
            <span class="keyword">return</span> _market_cache[<span class="string">"data"</span>]
        data = client.get(<span class="string">"/v1/trading/markets"</span>)
        _market_cache[<span class="string">"data"</span>] = data
        _market_cache[<span class="string">"ts"</span>] = time.time()
        <span class="keyword">return</span> data</div>
    </section>
  </section>

  <!-- Upgrade -->
  <section id="upgrade">
    <h2>Upgrading Your Tier</h2>
    <p>The Free tier is sufficient for development, testing, and low-frequency agents. For agents running at production scale, Pro or Enterprise tiers remove practical limits.</p>

    <table class="param-table">
      <thead>
        <tr>
          <th>Tier</th>
          <th>How to Activate</th>
          <th>Turnaround</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span class="tier-badge tier-free">Free</span></td>
          <td>Default on registration ‚Äî no action required</td>
          <td>Instant</td>
        </tr>
        <tr>
          <td><span class="tier-badge tier-pro">Pro</span></td>
          <td>Email <a href="mailto:hello@purpleflea.com">hello@purpleflea.com</a> with your API key</td>
          <td>Within 24 hours</td>
        </tr>
        <tr>
          <td><span class="tier-badge tier-enterprise">Enterprise</span></td>
          <td>Email <a href="mailto:hello@purpleflea.com">hello@purpleflea.com</a> with your use case and expected volume</td>
          <td>Within 48 hours</td>
        </tr>
      </tbody>
    </table>

    <div class="callout callout-purple">
      <span class="callout-icon">&#9830;</span>
      <p><strong>Enterprise SLA includes:</strong> Dedicated rate limit pools, priority support, custom per-endpoint caps, and uptime SLA commitments. Suitable for agent fleets generating consistent high-volume traffic across all APIs.</p>
    </div>

    <p>To upgrade, email <a href="mailto:hello@purpleflea.com">hello@purpleflea.com</a> with your API key and a brief description of your agent's use case. Tier upgrades are applied to the API key within the stated turnaround time. No payment processor or dashboard is required ‚Äî upgrades are handled manually.</p>
  </section>

</main>

<script>
function copyBlock(id, btn) {
  const el = document.getElementById(id);
  const text = el.innerText.replace(/^Copy$|^Copied!$/m, '').trim();
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = 'Copied!';
    setTimeout(() => btn.textContent = 'Copy', 2000);
  });
}

const sections = document.querySelectorAll('section[id]');
const links = document.querySelectorAll('.sidebar-link');
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      links.forEach(l => l.classList.remove('active'));
      const active = document.querySelector(`.sidebar-link[href="#${entry.target.id}"]`);
      if (active) active.classList.add('active');
    }
  });
}, { rootMargin: '-30% 0px -60% 0px' });
sections.forEach(s => observer.observe(s));
</script>

</body>
</html>
