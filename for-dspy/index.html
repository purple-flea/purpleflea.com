<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Purple Flea Ã— DSPy â€” Financial Tools for DSPy Agents</title>
<meta name="description" content="Build DSPy agents with real financial APIs. Purple Flea provides crypto wallets, 275 perpetual markets, provably fair casino, and domain registration as DSPy ReAct tools. Optimizer-compatible.">
<link rel="canonical" href="https://purpleflea.com/for-dspy">
<meta property="og:title" content="Purple Flea Ã— DSPy â€” Financial Tools for DSPy Agents">
<meta property="og:description" content="DSPy ReAct tools for Purple Flea APIs. Let your DSPy programs bet, trade, swap, and register domains. Optimizer-compatible. Works with any LM.">
<meta property="og:url" content="https://purpleflea.com/for-dspy">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Purple Flea">
<meta property="og:image" content="https://purpleflea.com/flea.jpg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@purpleflea">
<meta name="twitter:title" content="Purple Flea Ã— DSPy â€” Financial Agents with Optimizable Prompts">
<meta name="twitter:description" content="DSPy signatures, ChainOfThought, and ReAct tools for crypto wallets, 275 perp markets, casino, and domain registration.">
<meta name="twitter:image" content="https://purpleflea.com/flea.jpg">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Purple Flea DSPy Integration",
  "url": "https://purpleflea.com/for-dspy",
  "applicationCategory": "DeveloperApplication",
  "description": "DSPy ReAct tools and optimizable modules for Purple Flea financial APIs â€” crypto wallets, perpetual futures, casino, and domain registration.",
  "offers": {"@type": "Offer", "price": "0", "priceCurrency": "USD"}
}
</script>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŸ£</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --purple: #A855F7;
  --purple-dim: #7C3AED;
  --purple-glow: rgba(168, 85, 247, 0.3);
  --purple-subtle: rgba(168, 85, 247, 0.08);
  --bg: #09090B;
  --text: #FAFAFA;
  --text-secondary: #A1A1AA;
  --text-muted: #71717A;
  --border: rgba(255,255,255,0.06);
  --bg-card: rgba(255,255,255,0.03);
  --bg-card-hover: rgba(255,255,255,0.06);
  --border-hover: rgba(168, 85, 247, 0.3);
  --radius: 16px;
  --radius-sm: 10px;
}
html { scroll-behavior: smooth; }
body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; overflow-x: hidden; -webkit-font-smoothing: antialiased; }
body::before { content: ''; position: fixed; inset: 0; z-index: 9999; pointer-events: none; opacity: 0.025; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E"); background-repeat: repeat; background-size: 180px; }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(168, 85, 247, 0.3); border-radius: 3px; }
::selection { background: rgba(168, 85, 247, 0.4); color: white; }
.container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }
.reveal { opacity: 0; transform: translateY(30px); transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), transform 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
.reveal.visible { opacity: 1; transform: translateY(0); }
.reveal-delay-1 { transition-delay: 0.1s; }
.reveal-delay-2 { transition-delay: 0.2s; }
.reveal-delay-3 { transition-delay: 0.3s; }

/* NAV */
nav { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; padding: 16px 0; transition: all 0.3s ease; }
nav.scrolled { background: rgba(9, 9, 11, 0.85); backdrop-filter: blur(20px) saturate(1.5); border-bottom: 1px solid var(--border); }
.nav-inner { display: flex; align-items: center; justify-content: space-between; max-width: 1200px; margin: 0 auto; padding: 0 24px; }
.nav-logo { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 18px; text-decoration: none; color: var(--text); }
.nav-logo-icon { width: 32px; height: 32px; background: linear-gradient(135deg, var(--purple), var(--purple-dim)); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
.nav-links { display: flex; align-items: center; gap: 32px; list-style: none; }
.nav-links a { color: var(--text-secondary); text-decoration: none; font-size: 14px; font-weight: 450; transition: color 0.2s; }
.nav-links a:hover { color: var(--text); }
.nav-cta { display: inline-flex; align-items: center; gap: 6px; padding: 8px 18px; background: var(--purple); color: white !important; border-radius: 8px; font-weight: 500; font-size: 14px; text-decoration: none; transition: all 0.2s; }
.nav-cta:hover { background: var(--purple-dim); transform: translateY(-1px); }
@media (max-width: 768px) { .nav-links { display: none; } }

/* HERO */
.hero { min-height: 82vh; display: flex; align-items: center; justify-content: center; position: relative; padding: 120px 0 80px; overflow: hidden; }
.hero-bg { position: absolute; inset: 0; overflow: hidden; }
.hero-gradient-1 { position: absolute; top: -30%; left: 50%; transform: translateX(-50%); width: 900px; height: 600px; background: radial-gradient(ellipse, rgba(168, 85, 247, 0.15) 0%, transparent 70%); filter: blur(60px); }
.hero-grid { position: absolute; inset: 0; background-image: linear-gradient(rgba(168, 85, 247, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(168, 85, 247, 0.03) 1px, transparent 1px); background-size: 60px 60px; mask-image: radial-gradient(ellipse 60% 50% at 50% 50%, black 30%, transparent 100%); -webkit-mask-image: radial-gradient(ellipse 60% 50% at 50% 50%, black 30%, transparent 100%); }
.hero-content { position: relative; text-align: center; max-width: 860px; margin: 0 auto; padding: 0 24px; }
.hero-badge { display: inline-flex; align-items: center; gap: 8px; padding: 6px 16px 6px 10px; background: var(--purple-subtle); border: 1px solid rgba(168, 85, 247, 0.2); border-radius: 100px; font-size: 13px; font-weight: 600; color: var(--purple); margin-bottom: 32px; animation: fadeInDown 0.8s ease; letter-spacing: 0.01em; }
.hero-badge-dot { width: 8px; height: 8px; background: var(--purple); border-radius: 50%; animation: badge-pulse 2s ease-in-out infinite; }
@keyframes badge-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
@keyframes fadeInDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes gradient-shift { 0% { background-position: 0% center; } 50% { background-position: 100% center; } 100% { background-position: 0% center; } }
.hero h1 { font-size: clamp(2.6rem, 6vw, 4.6rem); font-weight: 800; line-height: 1.05; letter-spacing: -0.03em; margin-bottom: 24px; animation: fadeInUp 0.8s ease 0.1s both; }
.hero h1 .gradient { background: linear-gradient(135deg, var(--purple) 0%, #C084FC 50%, var(--purple) 100%); background-size: 200% auto; -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; animation: gradient-shift 5s ease infinite; }
.hero-desc { font-size: clamp(1rem, 2vw, 1.2rem); color: var(--text-secondary); margin-bottom: 40px; line-height: 1.75; animation: fadeInUp 0.8s ease 0.2s both; }
.hero-actions { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; animation: fadeInUp 0.8s ease 0.3s both; }
.btn-primary { display: inline-flex; align-items: center; gap: 8px; padding: 14px 28px; background: var(--purple); color: white; border-radius: var(--radius-sm); font-weight: 600; font-size: 15px; text-decoration: none; transition: all 0.2s; box-shadow: 0 0 30px rgba(168, 85, 247, 0.3); }
.btn-primary:hover { background: var(--purple-dim); transform: translateY(-2px); box-shadow: 0 0 40px rgba(168, 85, 247, 0.5); }
.btn-secondary { display: inline-flex; align-items: center; gap: 8px; padding: 14px 28px; background: var(--bg-card); color: var(--text); border-radius: var(--radius-sm); font-weight: 500; font-size: 15px; text-decoration: none; border: 1px solid var(--border); transition: all 0.2s; }
.btn-secondary:hover { border-color: var(--border-hover); background: var(--bg-card-hover); transform: translateY(-2px); }

/* SECTIONS */
section { padding: 100px 0; position: relative; }
.section-label { display: inline-flex; align-items: center; gap: 12px; font-size: 12px; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; color: var(--purple); margin-bottom: 20px; }
.section-label::before { content: ''; width: 24px; height: 1px; background: var(--purple); }
.section-title { font-size: clamp(2rem, 4vw, 3rem); font-weight: 800; letter-spacing: -0.02em; margin-bottom: 20px; line-height: 1.1; }
.section-desc { font-size: 1.05rem; color: var(--text-secondary); max-width: 640px; margin-bottom: 56px; line-height: 1.75; }
.section-divider { border: none; height: 1px; background: linear-gradient(90deg, transparent, var(--border), transparent); margin: 0; }

/* CODE BLOCKS */
.code-block { background: rgba(0,0,0,0.45); border: 1px solid var(--border); border-radius: var(--radius); padding: 28px; font-family: 'JetBrains Mono', monospace; font-size: 13px; line-height: 1.75; overflow-x: auto; position: relative; }
.code-block .code-header { display: flex; align-items: center; gap: 8px; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.code-dot { width: 12px; height: 12px; border-radius: 50%; }
.code-dot.red { background: #EF4444; }
.code-dot.yellow { background: #FBBF24; }
.code-dot.green { background: #22C55E; }
.code-filename { margin-left: 8px; font-size: 12px; color: var(--text-muted); }
.kw { color: #C084FC; }
.fn { color: #93C5FD; }
.st { color: #86EFAC; }
.cm { color: var(--text-muted); font-style: italic; }
.num { color: #FDE68A; }
.cls { color: #F9A8D4; }
.at { color: #A855F7; }
.op { color: #94A3B8; }
.de { color: #67E8F9; }

/* GRID */
.grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
.grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
@media (max-width: 900px) { .grid-2 { grid-template-columns: 1fr; } }
@media (max-width: 768px) { .grid-3 { grid-template-columns: 1fr; } }

/* CARDS */
.card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 32px; transition: all 0.3s ease; }
.card:hover { background: var(--bg-card-hover); border-color: var(--border-hover); transform: translateY(-4px); box-shadow: 0 20px 60px rgba(0,0,0,0.4), 0 0 30px rgba(168,85,247,0.05); }
.card-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; margin-bottom: 20px; }
.card-icon.purple { background: rgba(168, 85, 247, 0.15); }
.card-icon.blue { background: rgba(96, 165, 250, 0.15); }
.card-icon.green { background: rgba(34, 197, 94, 0.15); }
.card-icon.orange { background: rgba(251, 146, 60, 0.15); }
.card-icon.teal { background: rgba(20, 184, 166, 0.15); }
.card h3 { font-size: 1.05rem; font-weight: 600; margin-bottom: 10px; }
.card p { color: var(--text-secondary); font-size: 0.9rem; line-height: 1.65; }
.card code { font-family: 'JetBrains Mono', monospace; font-size: 0.85em; color: var(--purple); background: var(--purple-subtle); padding: 1px 5px; border-radius: 4px; }

/* INSTALL BANNER */
.install-banner { background: rgba(168, 85, 247, 0.06); border: 1px solid rgba(168, 85, 247, 0.2); border-radius: var(--radius-sm); padding: 18px 24px; display: flex; align-items: center; gap: 12px; margin-bottom: 40px; font-family: 'JetBrains Mono', monospace; font-size: 14px; }
.install-banner .pip { color: var(--text-muted); user-select: none; }
.install-banner .pkg { color: var(--purple); font-weight: 600; }
.copy-btn { margin-left: auto; padding: 6px 14px; background: var(--purple-subtle); border: 1px solid var(--border-hover); color: var(--purple); border-radius: 6px; font-size: 12px; cursor: pointer; font-family: 'Inter', sans-serif; transition: all 0.2s; white-space: nowrap; }
.copy-btn:hover { background: rgba(168,85,247,0.15); }

/* CONCEPT BLOCKS */
.concept-grid { display: flex; flex-direction: column; gap: 0; }
.concept-item { display: grid; grid-template-columns: 1fr 1fr; gap: 60px; padding: 64px 0; border-bottom: 1px solid var(--border); align-items: start; }
.concept-item:last-child { border-bottom: none; }
.concept-item.reverse { direction: rtl; }
.concept-item.reverse > * { direction: ltr; }
.concept-meta { padding-top: 8px; }
.concept-tag { display: inline-block; font-size: 11px; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; color: var(--purple); background: var(--purple-subtle); border: 1px solid rgba(168,85,247,0.15); padding: 4px 10px; border-radius: 4px; margin-bottom: 16px; }
.concept-meta h3 { font-size: 1.5rem; font-weight: 700; letter-spacing: -0.02em; margin-bottom: 14px; line-height: 1.2; }
.concept-meta p { color: var(--text-secondary); font-size: 0.95rem; line-height: 1.75; }
.concept-meta p + p { margin-top: 12px; }
@media (max-width: 900px) { .concept-item { grid-template-columns: 1fr; gap: 28px; } .concept-item.reverse { direction: ltr; } }

/* TOOLS TABLE */
.tools-table-wrap { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
.tools-table { width: 100%; border-collapse: collapse; }
.tools-table th { text-align: left; padding: 14px 20px; font-size: 11px; font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase; color: var(--text-muted); border-bottom: 1px solid var(--border); background: rgba(0,0,0,0.2); }
.tools-table td { padding: 14px 20px; font-size: 13.5px; border-bottom: 1px solid var(--border); vertical-align: middle; }
.tools-table tr:last-child td { border-bottom: none; }
.tools-table tr:hover td { background: var(--bg-card-hover); }
.tools-table .tool-name { font-family: 'JetBrains Mono', monospace; color: var(--purple); font-size: 12.5px; white-space: nowrap; }
.tools-table .tool-sig { font-family: 'JetBrains Mono', monospace; color: var(--text-secondary); font-size: 11.5px; }
.tools-table .tool-desc { color: var(--text-secondary); font-size: 13px; }
.badge { display: inline-block; padding: 2px 9px; border-radius: 4px; font-size: 11px; font-weight: 500; white-space: nowrap; }
.badge-casino { background: rgba(168,85,247,0.15); color: var(--purple); }
.badge-trading { background: rgba(34,197,94,0.15); color: #22C55E; }
.badge-wallet { background: rgba(96,165,250,0.15); color: #60A5FA; }
.badge-swap { background: rgba(251,146,60,0.15); color: #FB923C; }

/* SPLIT LAYOUT */
.split { display: grid; grid-template-columns: 1fr 1fr; gap: 48px; align-items: start; }
.split.reverse-cols { }
@media (max-width: 900px) { .split { grid-template-columns: 1fr; } }

/* WHY CARDS */
.why-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
@media (max-width: 768px) { .why-grid { grid-template-columns: 1fr; } }
.why-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 28px; }
.why-card h4 { font-size: 1rem; font-weight: 600; margin-bottom: 8px; }
.why-card p { color: var(--text-secondary); font-size: 0.875rem; line-height: 1.65; }

/* STEP FLOW */
.step-flow { display: flex; flex-direction: column; gap: 0; }
.step-row { display: flex; gap: 24px; padding: 28px 0; border-bottom: 1px solid var(--border); align-items: flex-start; }
.step-row:last-child { border-bottom: none; }
.step-num { width: 36px; height: 36px; min-width: 36px; border-radius: 9px; background: var(--purple-subtle); border: 1px solid rgba(168,85,247,0.2); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 13px; color: var(--purple); font-family: 'JetBrains Mono', monospace; }
.step-row h4 { font-size: 1rem; font-weight: 600; margin-bottom: 6px; }
.step-row p { color: var(--text-secondary); font-size: 0.875rem; line-height: 1.65; }
.step-row code { font-family: 'JetBrains Mono', monospace; font-size: 0.85em; color: var(--purple); }

/* METRICS ROW */
.metrics-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 64px; }
@media (max-width: 900px) { .metrics-row { grid-template-columns: repeat(2, 1fr); } }
.metric-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 24px; text-align: center; }
.metric-val { font-size: 2rem; font-weight: 800; letter-spacing: -0.03em; color: var(--purple); font-family: 'JetBrains Mono', monospace; margin-bottom: 4px; }
.metric-label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; }

/* RELATED LINKS */
.related-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
@media (max-width: 768px) { .related-grid { grid-template-columns: 1fr; } }
.related-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 20px 24px; text-decoration: none; color: var(--text); display: block; transition: all 0.2s; }
.related-card:hover { border-color: var(--border-hover); background: var(--bg-card-hover); transform: translateY(-2px); }
.related-card .label { font-size: 11px; color: var(--purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; }
.related-card .title { font-size: 14px; font-weight: 600; }
.related-card .desc { font-size: 13px; color: var(--text-muted); margin-top: 4px; }

/* CTA SECTION */
.cta-section { text-align: center; padding: 100px 0; }
.cta-box { background: linear-gradient(135deg, rgba(168,85,247,0.08) 0%, rgba(124,58,237,0.05) 100%); border: 1px solid rgba(168,85,247,0.2); border-radius: 24px; padding: 80px 40px; position: relative; overflow: hidden; }
.cta-box::before { content: ''; position: absolute; top: -50%; left: 50%; transform: translateX(-50%); width: 600px; height: 400px; background: radial-gradient(ellipse, rgba(168,85,247,0.1) 0%, transparent 70%); filter: blur(40px); pointer-events: none; }
.cta-box h2 { font-size: clamp(2rem, 4vw, 3rem); font-weight: 800; letter-spacing: -0.02em; margin-bottom: 20px; position: relative; line-height: 1.1; }
.cta-box p { color: var(--text-secondary); font-size: 1.1rem; margin-bottom: 40px; position: relative; }
.cta-links { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; position: relative; }

/* FOOTER */
footer { padding: 60px 0 40px; border-top: 1px solid var(--border); }
.footer-top { display: grid; grid-template-columns: 1fr 2fr; gap: 60px; margin-bottom: 60px; }
.footer-brand p { color: var(--text-secondary); font-size: 14px; margin-top: 16px; max-width: 260px; line-height: 1.6; }
.footer-columns { display: grid; grid-template-columns: repeat(3, 1fr); gap: 40px; }
.footer-col h4 { font-size: 13px; font-weight: 600; margin-bottom: 16px; }
.footer-col ul { list-style: none; display: flex; flex-direction: column; gap: 10px; }
.footer-col a { color: var(--text-muted); text-decoration: none; font-size: 13px; transition: color 0.2s; }
.footer-col a:hover { color: var(--text); }
.footer-bottom { display: flex; align-items: center; justify-content: space-between; padding-top: 24px; border-top: 1px solid var(--border); }
.footer-bottom p { color: var(--text-muted); font-size: 13px; }
.footer-social { display: flex; gap: 24px; }
.footer-social a { color: var(--text-muted); text-decoration: none; font-size: 13px; transition: color 0.2s; }
.footer-social a:hover { color: var(--text); }
@media (max-width: 768px) { .footer-top { grid-template-columns: 1fr; gap: 40px; } .footer-columns { grid-template-columns: repeat(2, 1fr); } .footer-bottom { flex-direction: column; gap: 16px; text-align: center; } }

/* INLINE CODE */
ic { font-family: 'JetBrains Mono', monospace; font-size: 0.88em; color: var(--purple); background: var(--purple-subtle); padding: 2px 6px; border-radius: 4px; }
</style>
</head>
<body>

<nav id="navbar">
  <div class="nav-inner">
    <a href="/" class="nav-logo">
      <div class="nav-logo-icon">&#9830;</div>
      Purple Flea
    </a>
    <ul class="nav-links">
      <li><a href="/docs">Docs</a></li>
      <li><a href="/for-agents">For Agents</a></li>
      <li><a href="/integrations">Integrations</a></li>
      <li><a href="/pricing">Pricing</a></li>
      <li><a href="https://wallet.purpleflea.com" target="_blank" class="nav-cta">Get Started &rarr;</a></li>
    </ul>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="hero-bg">
    <div class="hero-gradient-1"></div>
    <div class="hero-grid"></div>
  </div>
  <div class="hero-content">
    <div class="hero-badge">
      <div class="hero-badge-dot"></div>
      Purple Flea &times; DSPy
    </div>
    <h1><span class="gradient">DSPy Agents</span><br>with Financial Tools</h1>
    <p class="hero-desc">
      DSPy programs LLMs with composable modules and optimizable signatures.<br>
      Purple Flea gives those modules a real wallet, 275 perp markets, a provably fair casino,<br>
      and domain registration. The LM reasons. The money moves.
    </p>
    <div class="hero-actions">
      <a href="https://wallet.purpleflea.com" target="_blank" class="btn-primary">Register your agent &rarr;</a>
      <a href="https://dspy.ai" target="_blank" class="btn-secondary">DSPy docs &nearr;</a>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- WHAT IS DSPY -->
<section id="what-is-dspy">
  <div class="container">
    <div class="reveal">
      <div class="section-label">What is DSPy</div>
      <h2 class="section-title">Composable LM programming,<br>not prompt engineering.</h2>
      <p class="section-desc">
        DSPy is Stanford's framework for building LLM applications you can actually optimize. Instead of writing brittle prompt strings, you define typed <strong>Signatures</strong>, compose them into <strong>Modules</strong>, then run an <strong>Optimizer</strong> to find prompts that maximize your metric on real data.
      </p>
    </div>

    <div class="why-grid reveal reveal-delay-1">
      <div class="why-card">
        <h4>Signatures, not prompts</h4>
        <p>A Signature is a Python class describing input/output fields with types and doc-strings. DSPy turns it into a prompt automatically &mdash; and can rewrite it when an optimizer runs.</p>
      </div>
      <div class="why-card">
        <h4>Modules, not chains</h4>
        <p><code style="font-family:'JetBrains Mono',monospace;color:var(--purple)">dspy.ChainOfThought</code>, <code style="font-family:'JetBrains Mono',monospace;color:var(--purple)">dspy.ReAct</code>, and <code style="font-family:'JetBrains Mono',monospace;color:var(--purple)">dspy.Predict</code> are composable modules that hold learnable parameters: demonstrations and instructions.</p>
      </div>
      <div class="why-card">
        <h4>Optimizers, not manual tuning</h4>
        <p>MIPRO, BootstrapFewShot, and COPRO compile your program against a training set. They find better instructions and few-shot examples automatically, without touching your module code.</p>
      </div>
      <div class="why-card">
        <h4>Any LM backend</h4>
        <p>One <code style="font-family:'JetBrains Mono',monospace;color:var(--purple)">dspy.configure(lm=...)</code> call wires up OpenAI, Anthropic, Gemini, Mistral, or any local model. Swap backends without rewriting your program.</p>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- WHY DSPY + PURPLE FLEA -->
<section id="why">
  <div class="container">
    <div class="reveal">
      <div class="section-label">Why DSPy + Purple Flea</div>
      <h2 class="section-title">DSPy handles the reasoning.<br>Purple Flea handles the money.</h2>
      <p class="section-desc">
        DSPy is designed to optimize <em>how</em> an LM thinks. Purple Flea is designed to execute <em>what</em> the LM decides. They compose naturally: DSPy provides the reasoning loop, Purple Flea provides the real-world financial actions those decisions trigger.
      </p>
    </div>

    <div class="split reveal reveal-delay-1">
      <div>
        <div class="step-flow">
          <div class="step-row">
            <div class="step-num">01</div>
            <div>
              <h4>Write a Signature</h4>
              <p>Describe the financial decision your module makes: inputs like <code>portfolio_state</code> and <code>market_data</code>, outputs like <code>action</code> and <code>reasoning</code>. DSPy synthesizes the prompt.</p>
            </div>
          </div>
          <div class="step-row">
            <div class="step-num">02</div>
            <div>
              <h4>Add Purple Flea as tools</h4>
              <p>Register Purple Flea API calls as Python functions and pass them to <code>dspy.ReAct</code>. The agent decides when to call <code>get_balance</code>, <code>place_bet</code>, <code>open_trade</code>, or <code>swap_tokens</code>.</p>
            </div>
          </div>
          <div class="step-row">
            <div class="step-num">03</div>
            <div>
              <h4>Measure outcomes as a metric</h4>
              <p>Track P&amp;L, win rate, or any financial metric as a DSPy metric function. Feed historical outcomes back to the optimizer to improve the agent's decision-making prompts.</p>
            </div>
          </div>
          <div class="step-row">
            <div class="step-num">04</div>
            <div>
              <h4>Run the optimizer</h4>
              <p>MIPRO compiles your agent against the training set, searching for instructions and demonstrations that maximize your metric. Deploy the optimized program.</p>
            </div>
          </div>
        </div>
      </div>
      <div>
        <div class="code-block">
          <div class="code-header">
            <div class="code-dot red"></div>
            <div class="code-dot yellow"></div>
            <div class="code-dot green"></div>
            <span class="code-filename">quick_start.py</span>
          </div>
<span class="kw">import</span> dspy
<span class="kw">import</span> requests

<span class="cm"># 1. Configure LM backend</span>
dspy.configure(lm=dspy.LM(<span class="st">"openai/gpt-4o"</span>))

<span class="cm"># 2. Define a Purple Flea tool</span>
<span class="kw">def</span> <span class="fn">get_balance</span>(api_key: <span class="cls">str</span>) -> <span class="cls">dict</span>:
    <span class="st">"""Return wallet ETH balance."""</span>
    r = requests.<span class="fn">get</span>(
        <span class="st">"https://api.purpleflea.com/wallet/balance"</span>,
        headers={<span class="st">"X-API-Key"</span>: api_key}
    )
    <span class="kw">return</span> r.<span class="fn">json</span>()

<span class="cm"># 3. Build a ReAct agent</span>
agent = dspy.ReAct(
    <span class="st">"Check balance and report portfolio status"</span>,
    tools=[get_balance]
)

<span class="cm"># 4. Run it</span>
result = agent(api_key=<span class="st">"pf_..."</span>)
<span class="fn">print</span>(result.answer)
        </div>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- SETUP -->
<section id="setup">
  <div class="container">
    <div class="reveal">
      <div class="section-label">Setup</div>
      <h2 class="section-title">Install in two packages.</h2>
      <p class="section-desc">
        DSPy and the standard <code style="font-family:'JetBrains Mono',monospace;color:var(--purple)">requests</code> library are all you need. Purple Flea APIs are plain REST &mdash; no special SDK required, though one is available.
      </p>
    </div>

    <div class="reveal reveal-delay-1">
      <div class="install-banner">
        <span class="pip">$</span>
        <span class="pkg">pip install dspy-ai requests</span>
        <button class="copy-btn" onclick="navigator.clipboard.writeText('pip install dspy-ai requests').then(()=>{this.textContent='Copied!';setTimeout(()=>this.textContent='Copy',1500)})">Copy</button>
      </div>
    </div>

    <div class="split reveal reveal-delay-2">
      <div class="code-block">
        <div class="code-header">
          <div class="code-dot red"></div>
          <div class="code-dot yellow"></div>
          <div class="code-dot green"></div>
          <span class="code-filename">configure.py</span>
        </div>
<span class="kw">import</span> dspy
<span class="kw">import</span> os

<span class="cm"># Use any LM â€” swap freely</span>
dspy.configure(lm=dspy.LM(
    <span class="st">"openai/gpt-4o"</span>,
    api_key=os.environ[<span class="st">"OPENAI_API_KEY"</span>]
))

<span class="cm"># Or Anthropic</span>
<span class="cm"># dspy.configure(lm=dspy.LM("anthropic/claude-opus-4-6"))</span>

<span class="cm"># Or a local model via Ollama</span>
<span class="cm"># dspy.configure(lm=dspy.LM("ollama_chat/llama3.1"))</span>

<span class="cm"># Purple Flea API key from environment</span>
PF_KEY = os.environ[<span class="st">"PURPLEFLEA_API_KEY"</span>]
PF_BASE = <span class="st">"https://api.purpleflea.com"</span>
      </div>
      <div>
        <div class="card" style="margin-bottom:20px;">
          <h3 style="margin-bottom:10px;">Get a Purple Flea API key</h3>
          <p>Register at <a href="https://wallet.purpleflea.com" target="_blank" style="color:var(--purple);text-decoration:none;">wallet.purpleflea.com</a>. Your API key unlocks wallet, trading, casino, and domain endpoints. Free to start.</p>
        </div>
        <div class="card">
          <h3 style="margin-bottom:10px;">Authentication</h3>
          <p>Every Purple Flea API call takes an <ic>X-API-Key</ic> header. Pass it as a parameter through your DSPy module so the optimizer can use it in demonstrations without hardcoding secrets.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- CORE CONCEPTS -->
<section id="concepts">
  <div class="container">
    <div class="reveal">
      <div class="section-label">Core DSPy Concepts</div>
      <h2 class="section-title">Signatures, Modules, and ReAct<br>in a financial context.</h2>
    </div>

    <div class="concept-grid">

      <!-- Signatures -->
      <div class="concept-item reveal">
        <div class="concept-meta">
          <div class="concept-tag">Signatures</div>
          <h3>Define input/output for financial operations</h3>
          <p>A Signature is a Python class that inherits from <ic>dspy.Signature</ic>. It declares what information goes in and what decision comes out. For financial agents, inputs are portfolio state and market conditions; outputs are the action to take and the reasoning behind it.</p>
          <p>DSPy compiles the Signature into a prompt automatically. Optimizers can rewrite the docstring and add demonstrations to improve the output quality &mdash; without you touching any prompt text.</p>
        </div>
        <div class="code-block">
          <div class="code-header">
            <div class="code-dot red"></div>
            <div class="code-dot yellow"></div>
            <div class="code-dot green"></div>
            <span class="code-filename">signatures.py</span>
          </div>
<span class="kw">import</span> dspy

<span class="cm"># Signature for a bet sizing decision</span>
<span class="kw">class</span> <span class="cls">BetSizing</span>(dspy.Signature):
    <span class="st">"""Apply Kelly criterion to size a casino bet."""</span>
    bankroll_eth: <span class="cls">float</span> = dspy.InputField(
        desc=<span class="st">"Current bankroll in ETH"</span>
    )
    win_probability: <span class="cls">float</span> = dspy.InputField(
        desc=<span class="st">"Estimated probability of winning"</span>
    )
    payout_ratio: <span class="cls">float</span> = dspy.InputField(
        desc=<span class="st">"Net payout per unit bet (e.g. 1.0 for coinflip)"</span>
    )
    bet_eth: <span class="cls">float</span> = dspy.OutputField(
        desc=<span class="st">"Bet size in ETH (Kelly-optimal)"</span>
    )
    reasoning: <span class="cls">str</span> = dspy.OutputField(
        desc=<span class="st">"Step-by-step Kelly calculation"</span>
    )

<span class="cm"># Signature for a perp trade decision</span>
<span class="kw">class</span> <span class="cls">TradeDecision</span>(dspy.Signature):
    <span class="st">"""Decide whether to open, close, or hold a perp position."""</span>
    market: <span class="cls">str</span> = dspy.InputField()
    price_data: <span class="cls">str</span> = dspy.InputField()
    open_positions: <span class="cls">str</span> = dspy.InputField()
    action: <span class="cls">str</span> = dspy.OutputField(
        desc=<span class="st">"'buy', 'sell', 'close', or 'hold'"</span>
    )
    size_usd: <span class="cls">float</span> = dspy.OutputField()
    leverage: <span class="cls">int</span> = dspy.OutputField(
        desc=<span class="st">"1-50"</span>
    )
        </div>
      </div>

      <!-- ChainOfThought -->
      <div class="concept-item reverse reveal">
        <div class="concept-meta">
          <div class="concept-tag">ChainOfThought</div>
          <h3>Multi-step financial reasoning</h3>
          <p><ic>dspy.ChainOfThought</ic> wraps any Signature and adds a scratchpad: the LM is forced to reason step by step before committing to an output. For financial decisions &mdash; position sizing, Kelly criterion, trend analysis &mdash; this dramatically improves accuracy over direct prediction.</p>
          <p>The reasoning field is captured and stored. When the optimizer compiles demonstrations, it selects examples where the chain-of-thought reasoning led to good outcomes, teaching the model how to think about financial data.</p>
        </div>
        <div class="code-block">
          <div class="code-header">
            <div class="code-dot red"></div>
            <div class="code-dot yellow"></div>
            <div class="code-dot green"></div>
            <span class="code-filename">chain_of_thought.py</span>
          </div>
<span class="kw">import</span> dspy
<span class="kw">import</span> requests

<span class="kw">class</span> <span class="cls">TradingAgent</span>(dspy.Module):
    <span class="kw">def</span> <span class="fn">__init__</span>(self):
        <span class="cm"># ChainOfThought for multi-step reasoning</span>
        self.analyze = dspy.ChainOfThought(TradeDecision)

    <span class="kw">def</span> <span class="fn">forward</span>(self, market, api_key):
        <span class="cm"># Fetch live data from Purple Flea</span>
        price = requests.<span class="fn">get</span>(
            <span class="st">f"https://api.purpleflea.com/market/{market}/price"</span>,
            headers={<span class="st">"X-API-Key"</span>: api_key}
        ).<span class="fn">json</span>()

        positions = requests.<span class="fn">get</span>(
            <span class="st">"https://api.purpleflea.com/trading/positions"</span>,
            headers={<span class="st">"X-API-Key"</span>: api_key}
        ).<span class="fn">json</span>()

        <span class="cm"># LM reasons step by step before deciding</span>
        decision = self.analyze(
            market=market,
            price_data=<span class="cls">str</span>(price),
            open_positions=<span class="cls">str</span>(positions)
        )

        <span class="cm"># Execute only if not holding</span>
        <span class="kw">if</span> decision.action != <span class="st">"hold"</span>:
            requests.<span class="fn">post</span>(
                <span class="st">"https://api.purpleflea.com/trading/order"</span>,
                json={
                    <span class="st">"market"</span>: market,
                    <span class="st">"side"</span>: decision.action,
                    <span class="st">"size_usd"</span>: decision.size_usd,
                    <span class="st">"leverage"</span>: decision.leverage
                },
                headers={<span class="st">"X-API-Key"</span>: api_key}
            )

        <span class="kw">return</span> decision
        </div>
      </div>

      <!-- ReAct -->
      <div class="concept-item reveal">
        <div class="concept-meta">
          <div class="concept-tag">ReAct</div>
          <h3>Tool-calling with Purple Flea APIs</h3>
          <p><ic>dspy.ReAct</ic> implements the Reason + Act loop. You pass a list of Python functions as tools. The LM reasons about what to do, decides which tool to call and with what arguments, observes the result, then reasons again until it reaches an answer.</p>
          <p>This maps directly to financial agent behavior: reason about portfolio state, call <ic>get_balance</ic>, observe the balance, decide to trade, call <ic>open_position</ic>, observe the confirmation, report back. Each step is logged for optimizer training.</p>
        </div>
        <div class="code-block">
          <div class="code-header">
            <div class="code-dot red"></div>
            <div class="code-dot yellow"></div>
            <div class="code-dot green"></div>
            <span class="code-filename">react_tools.py</span>
          </div>
<span class="kw">import</span> dspy, requests

PF = <span class="st">"https://api.purpleflea.com"</span>
KEY = <span class="st">"pf_your_api_key"</span>
H = {<span class="st">"X-API-Key"</span>: KEY}

<span class="kw">def</span> <span class="fn">get_balance</span>() -> <span class="cls">dict</span>:
    <span class="st">"""Return ETH and token balances."""</span>
    <span class="kw">return</span> requests.<span class="fn">get</span>(<span class="st">f"{PF}/wallet/balance"</span>, headers=H).<span class="fn">json</span>()

<span class="kw">def</span> <span class="fn">place_bet</span>(game: <span class="cls">str</span>, bet_eth: <span class="cls">float</span>, prediction: <span class="cls">str</span>) -> <span class="cls">dict</span>:
    <span class="st">"""Place a provably fair casino bet. game: 'coinflip'|'dice'|'roulette'."""</span>
    <span class="kw">return</span> requests.<span class="fn">post</span>(<span class="st">f"{PF}/casino/bet"</span>, headers=H,
        json={<span class="st">"game"</span>: game, <span class="st">"amount"</span>: bet_eth,
              <span class="st">"prediction"</span>: prediction}).<span class="fn">json</span>()

<span class="kw">def</span> <span class="fn">open_position</span>(market: <span class="cls">str</span>, side: <span class="cls">str</span>,
                    size_usd: <span class="cls">float</span>, leverage: <span class="cls">int</span>) -> <span class="cls">dict</span>:
    <span class="st">"""Open a perpetual futures position. side: 'buy'|'sell'."""</span>
    <span class="kw">return</span> requests.<span class="fn">post</span>(<span class="st">f"{PF}/trading/order"</span>, headers=H,
        json={<span class="st">"market"</span>: market, <span class="st">"side"</span>: side,
              <span class="st">"size_usd"</span>: size_usd, <span class="st">"leverage"</span>: leverage}).<span class="fn">json</span>()

<span class="kw">def</span> <span class="fn">swap_tokens</span>(from_token: <span class="cls">str</span>, to_token: <span class="cls">str</span>,
                  amount: <span class="cls">float</span>) -> <span class="cls">dict</span>:
    <span class="st">"""Swap tokens in the Purple Flea DEX."""</span>
    <span class="kw">return</span> requests.<span class="fn">post</span>(<span class="st">f"{PF}/swap"</span>, headers=H,
        json={<span class="st">"from"</span>: from_token, <span class="st">"to"</span>: to_token,
              <span class="st">"amount"</span>: amount}).<span class="fn">json</span>()

<span class="cm"># Build the ReAct agent</span>
agent = dspy.ReAct(
    <span class="st">"Manage portfolio: check balance, place bets, trade, swap as needed"</span>,
    tools=[get_balance, place_bet, open_position, swap_tokens]
)
        </div>
      </div>

    </div>
  </div>
</section>

<hr class="section-divider">

<!-- TOOL REFERENCE -->
<section id="tools">
  <div class="container">
    <div class="reveal">
      <div class="section-label">Purple Flea API Reference</div>
      <h2 class="section-title">Financial tools for your DSPy agents.</h2>
      <p class="section-desc">
        Every Purple Flea endpoint maps to a plain Python function your ReAct agent can call. Type hints in the docstring help DSPy generate correct arguments.
      </p>
    </div>

    <div class="tools-table-wrap reveal reveal-delay-1">
      <table class="tools-table">
        <thead>
          <tr>
            <th>Function</th>
            <th>Signature</th>
            <th>Description</th>
            <th>Category</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><div class="tool-name">get_balance()</div></td>
            <td><div class="tool-sig">() &rarr; dict</div></td>
            <td class="tool-desc">Returns ETH and all token balances for the registered wallet</td>
            <td><span class="badge badge-wallet">Wallet</span></td>
          </tr>
          <tr>
            <td><div class="tool-name">send_eth()</div></td>
            <td><div class="tool-sig">(to: str, amount: float) &rarr; dict</div></td>
            <td class="tool-desc">Send ETH to any address; returns transaction hash</td>
            <td><span class="badge badge-wallet">Wallet</span></td>
          </tr>
          <tr>
            <td><div class="tool-name">place_bet()</div></td>
            <td><div class="tool-sig">(game: str, bet_eth: float, prediction: str) &rarr; dict</div></td>
            <td class="tool-desc">Place a provably fair bet on coinflip, dice, roulette, or hi-lo</td>
            <td><span class="badge badge-casino">Casino</span></td>
          </tr>
          <tr>
            <td><div class="tool-name">get_game_odds()</div></td>
            <td><div class="tool-sig">(game: str) &rarr; dict</div></td>
            <td class="tool-desc">Returns house edge, payout table, and minimum bet for a game</td>
            <td><span class="badge badge-casino">Casino</span></td>
          </tr>
          <tr>
            <td><div class="tool-name">open_position()</div></td>
            <td><div class="tool-sig">(market: str, side: str, size_usd: float, leverage: int) &rarr; dict</div></td>
            <td class="tool-desc">Open a perpetual futures position across 275 Hyperliquid markets</td>
            <td><span class="badge badge-trading">Trading</span></td>
          </tr>
          <tr>
            <td><div class="tool-name">close_position()</div></td>
            <td><div class="tool-sig">(market: str) &rarr; dict</div></td>
            <td class="tool-desc">Close an open perp position at market price</td>
            <td><span class="badge badge-trading">Trading</span></td>
          </tr>
          <tr>
            <td><div class="tool-name">get_positions()</div></td>
            <td><div class="tool-sig">() &rarr; list</div></td>
            <td class="tool-desc">List all open perpetual positions with unrealized P&amp;L</td>
            <td><span class="badge badge-trading">Trading</span></td>
          </tr>
          <tr>
            <td><div class="tool-name">get_market_price()</div></td>
            <td><div class="tool-sig">(market: str) &rarr; dict</div></td>
            <td class="tool-desc">Current price, 24h change, funding rate, and open interest</td>
            <td><span class="badge badge-trading">Trading</span></td>
          </tr>
          <tr>
            <td><div class="tool-name">swap_tokens()</div></td>
            <td><div class="tool-sig">(from_token: str, to_token: str, amount: float) &rarr; dict</div></td>
            <td class="tool-desc">DEX swap with slippage estimate and execution confirmation</td>
            <td><span class="badge badge-swap">Swap</span></td>
          </tr>
          <tr>
            <td><div class="tool-name">register_domain()</div></td>
            <td><div class="tool-sig">(name: str, tld: str, years: int) &rarr; dict</div></td>
            <td class="tool-desc">Register a web3 or traditional domain; returns ENS/DNS record</td>
            <td><span class="badge badge-wallet">Domains</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- COMPLETE AGENT EXAMPLE -->
<section id="agents">
  <div class="container">
    <div class="reveal">
      <div class="section-label">Complete Code Examples</div>
      <h2 class="section-title">Full working agents.</h2>
      <p class="section-desc">
        Copy-paste ready implementations of a Kelly criterion casino agent and a ChainOfThought trading agent, plus a full ReAct orchestrator that calls both.
      </p>
    </div>

    <!-- Casino Agent -->
    <div class="reveal reveal-delay-1" style="margin-bottom:40px;">
      <div class="code-block">
        <div class="code-header">
          <div class="code-dot red"></div>
          <div class="code-dot yellow"></div>
          <div class="code-dot green"></div>
          <span class="code-filename">casino_agent.py &mdash; Kelly criterion bet sizing</span>
        </div>
<span class="kw">import</span> dspy
<span class="kw">import</span> requests

PF_BASE = <span class="st">"https://api.purpleflea.com"</span>
PF_KEY = <span class="st">"pf_your_api_key"</span>
HEADERS = {<span class="st">"X-API-Key"</span>: PF_KEY}

<span class="cm"># --- Signature ---</span>
<span class="kw">class</span> <span class="cls">KellyBetSizing</span>(dspy.Signature):
    <span class="st">"""Apply fractional Kelly criterion to size a casino bet conservatively."""</span>
    bankroll_eth: <span class="cls">float</span> = dspy.InputField(desc=<span class="st">"Total bankroll in ETH"</span>)
    win_prob: <span class="cls">float</span>    = dspy.InputField(desc=<span class="st">"Estimated win probability (0-1)"</span>)
    net_payout: <span class="cls">float</span>  = dspy.InputField(desc=<span class="st">"Net payout per unit bet"</span>)
    kelly_frac: <span class="cls">float</span>  = dspy.InputField(desc=<span class="st">"Kelly fraction (0.25 = quarter-Kelly)"</span>)
    bet_eth: <span class="cls">float</span>     = dspy.OutputField(desc=<span class="st">"Optimal bet size in ETH"</span>)
    reasoning: <span class="cls">str</span>    = dspy.OutputField(desc=<span class="st">"Full Kelly calculation with workings"</span>)
    should_bet: <span class="cls">bool</span>  = dspy.OutputField(desc=<span class="st">"False if Kelly fraction is negative"</span>)

<span class="cm"># --- Module ---</span>
<span class="kw">class</span> <span class="cls">CasinoAgent</span>(dspy.Module):
    <span class="kw">def</span> <span class="fn">__init__</span>(self, kelly_fraction: <span class="cls">float</span> = <span class="num">0.25</span>):
        self.kelly_frac = kelly_fraction
        self.size_bet = dspy.ChainOfThought(KellyBetSizing)

    <span class="kw">def</span> <span class="fn">forward</span>(self, game: <span class="cls">str</span> = <span class="st">"coinflip"</span>):
        <span class="cm"># Fetch live balance and game odds</span>
        balance = requests.<span class="fn">get</span>(
            <span class="st">f"{PF_BASE}/wallet/balance"</span>, headers=HEADERS
        ).<span class="fn">json</span>()
        odds = requests.<span class="fn">get</span>(
            <span class="st">f"{PF_BASE}/casino/odds/{game}"</span>, headers=HEADERS
        ).<span class="fn">json</span>()

        bankroll = <span class="cls">float</span>(balance[<span class="st">"eth"</span>])
        win_prob  = odds[<span class="st">"win_probability"</span>]
        payout    = odds[<span class="st">"net_payout"</span>]

        <span class="cm"># DSPy reasons through Kelly criterion</span>
        decision = self.size_bet(
            bankroll_eth=bankroll,
            win_prob=win_prob,
            net_payout=payout,
            kelly_frac=self.kelly_frac
        )

        <span class="kw">if not</span> decision.should_bet:
            <span class="kw">return</span> dspy.Prediction(
                outcome=<span class="st">"skip"</span>,
                reason=<span class="st">"Negative Kelly fraction â€” house edge too high"</span>
            )

        <span class="cm"># Place the bet via Purple Flea</span>
        result = requests.<span class="fn">post</span>(
            <span class="st">f"{PF_BASE}/casino/bet"</span>, headers=HEADERS,
            json={<span class="st">"game"</span>: game, <span class="st">"amount"</span>: decision.bet_eth,
                  <span class="st">"prediction"</span>: <span class="st">"heads"</span>}
        ).<span class="fn">json</span>()

        <span class="kw">return</span> dspy.Prediction(
            outcome=result[<span class="st">"outcome"</span>],
            pnl=result[<span class="st">"pnl_eth"</span>],
            bet_eth=decision.bet_eth,
            reasoning=decision.reasoning
        )

<span class="cm"># Run the agent</span>
dspy.configure(lm=dspy.LM(<span class="st">"openai/gpt-4o"</span>))
casino = <span class="cls">CasinoAgent</span>(kelly_fraction=<span class="num">0.25</span>)
result = casino.<span class="fn">forward</span>(game=<span class="st">"coinflip"</span>)
<span class="fn">print</span>(<span class="st">f"Outcome: {result.outcome} | P&amp;L: {result.pnl} ETH"</span>)
      </div>
    </div>

    <!-- Trading Agent -->
    <div class="reveal reveal-delay-2" style="margin-bottom:40px;">
      <div class="code-block">
        <div class="code-header">
          <div class="code-dot red"></div>
          <div class="code-dot yellow"></div>
          <div class="code-dot green"></div>
          <span class="code-filename">trading_agent.py &mdash; ChainOfThought position sizing</span>
        </div>
<span class="kw">import</span> dspy
<span class="kw">import</span> requests

<span class="kw">class</span> <span class="cls">PositionSizing</span>(dspy.Signature):
    <span class="st">"""Size a perpetual futures position using portfolio risk management."""</span>
    market: <span class="cls">str</span>         = dspy.InputField(desc=<span class="st">"e.g. 'BTC-PERP'"</span>)
    price: <span class="cls">float</span>        = dspy.InputField()
    change_24h: <span class="cls">float</span>   = dspy.InputField(desc=<span class="st">"% change in last 24h"</span>)
    funding_rate: <span class="cls">float</span> = dspy.InputField(desc=<span class="st">"annualized funding rate"</span>)
    portfolio_eth: <span class="cls">float</span>= dspy.InputField(desc=<span class="st">"Total portfolio value in ETH"</span>)
    max_risk_pct: <span class="cls">float</span> = dspy.InputField(desc=<span class="st">"Max portfolio % to risk (e.g. 2.0)"</span>)
    action: <span class="cls">str</span>         = dspy.OutputField(desc=<span class="st">"'buy', 'sell', or 'hold'"</span>)
    size_usd: <span class="cls">float</span>     = dspy.OutputField(desc=<span class="st">"Notional size in USD"</span>)
    leverage: <span class="cls">int</span>        = dspy.OutputField(desc=<span class="st">"1-20, prefer low leverage"</span>)
    stop_loss_pct: <span class="cls">float</span> = dspy.OutputField(desc=<span class="st">"Stop loss % from entry"</span>)
    rationale: <span class="cls">str</span>      = dspy.OutputField()

<span class="kw">class</span> <span class="cls">TradingAgent</span>(dspy.Module):
    <span class="kw">def</span> <span class="fn">__init__</span>(self, max_risk_pct: <span class="cls">float</span> = <span class="num">2.0</span>):
        self.max_risk = max_risk_pct
        self.decide   = dspy.ChainOfThought(PositionSizing)

    <span class="kw">def</span> <span class="fn">forward</span>(self, market: <span class="cls">str</span>):
        H = {<span class="st">"X-API-Key"</span>: PF_KEY}
        base = PF_BASE

        price_data = requests.<span class="fn">get</span>(
            <span class="st">f"{base}/market/{market}/price"</span>, headers=H
        ).<span class="fn">json</span>()
        balance = requests.<span class="fn">get</span>(
            <span class="st">f"{base}/wallet/balance"</span>, headers=H
        ).<span class="fn">json</span>()

        decision = self.decide(
            market=market,
            price=price_data[<span class="st">"price"</span>],
            change_24h=price_data[<span class="st">"change_24h"</span>],
            funding_rate=price_data[<span class="st">"funding_rate"</span>],
            portfolio_eth=<span class="cls">float</span>(balance[<span class="st">"eth"</span>]),
            max_risk_pct=self.max_risk
        )

        <span class="kw">if</span> decision.action == <span class="st">"hold"</span>:
            <span class="kw">return</span> dspy.Prediction(action=<span class="st">"hold"</span>,
                                       rationale=decision.rationale)

        order = requests.<span class="fn">post</span>(
            <span class="st">f"{base}/trading/order"</span>, headers=H,
            json={
                <span class="st">"market"</span>: market,
                <span class="st">"side"</span>:   decision.action,
                <span class="st">"size_usd"</span>: decision.size_usd,
                <span class="st">"leverage"</span>: decision.leverage,
                <span class="st">"stop_loss_pct"</span>: decision.stop_loss_pct
            }
        ).<span class="fn">json</span>()

        <span class="kw">return</span> dspy.Prediction(
            action=decision.action,
            order_id=order[<span class="st">"order_id"</span>],
            fill_price=order[<span class="st">"fill_price"</span>],
            rationale=decision.rationale
        )
      </div>
    </div>

    <!-- Full ReAct Orchestrator -->
    <div class="reveal reveal-delay-3">
      <div class="code-block">
        <div class="code-header">
          <div class="code-dot red"></div>
          <div class="code-dot yellow"></div>
          <div class="code-dot green"></div>
          <span class="code-filename">full_agent.py &mdash; ReAct orchestrator with all Purple Flea tools</span>
        </div>
<span class="kw">import</span> dspy
<span class="kw">import</span> requests

dspy.configure(lm=dspy.LM(<span class="st">"openai/gpt-4o"</span>))

PF_BASE = <span class="st">"https://api.purpleflea.com"</span>
H = {<span class="st">"X-API-Key"</span>: <span class="st">"pf_your_api_key"</span>}

<span class="cm"># â”€â”€ Purple Flea Tool Definitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

<span class="kw">def</span> <span class="fn">get_balance</span>() -> <span class="cls">dict</span>:
    <span class="st">"""Return current wallet balances: ETH, USDC, and all tokens."""</span>
    <span class="kw">return</span> requests.<span class="fn">get</span>(<span class="st">f"{PF_BASE}/wallet/balance"</span>, headers=H).<span class="fn">json</span>()

<span class="kw">def</span> <span class="fn">get_market_price</span>(market: <span class="cls">str</span>) -> <span class="cls">dict</span>:
    <span class="st">"""Get price, 24h change, funding rate, and open interest for a market."""</span>
    <span class="kw">return</span> requests.<span class="fn">get</span>(
        <span class="st">f"{PF_BASE}/market/{market}/price"</span>, headers=H
    ).<span class="fn">json</span>()

<span class="kw">def</span> <span class="fn">open_position</span>(market: <span class="cls">str</span>, side: <span class="cls">str</span>,
                    size_usd: <span class="cls">float</span>, leverage: <span class="cls">int</span>) -> <span class="cls">dict</span>:
    <span class="st">"""Open a perpetual position. side must be 'buy' or 'sell'. leverage 1-50."""</span>
    <span class="kw">return</span> requests.<span class="fn">post</span>(<span class="st">f"{PF_BASE}/trading/order"</span>, headers=H,
        json={<span class="st">"market"</span>: market, <span class="st">"side"</span>: side,
              <span class="st">"size_usd"</span>: size_usd, <span class="st">"leverage"</span>: leverage}).<span class="fn">json</span>()

<span class="kw">def</span> <span class="fn">close_position</span>(market: <span class="cls">str</span>) -> <span class="cls">dict</span>:
    <span class="st">"""Close any open position for the given market at market price."""</span>
    <span class="kw">return</span> requests.<span class="fn">post</span>(<span class="st">f"{PF_BASE}/trading/close/{market}"</span>,
                          headers=H).<span class="fn">json</span>()

<span class="kw">def</span> <span class="fn">place_bet</span>(game: <span class="cls">str</span>, bet_eth: <span class="cls">float</span>, prediction: <span class="cls">str</span>) -> <span class="cls">dict</span>:
    <span class="st">"""Place a provably fair bet. game: 'coinflip'|'dice'|'roulette'|'hilo'."""</span>
    <span class="kw">return</span> requests.<span class="fn">post</span>(<span class="st">f"{PF_BASE}/casino/bet"</span>, headers=H,
        json={<span class="st">"game"</span>: game, <span class="st">"amount"</span>: bet_eth,
              <span class="st">"prediction"</span>: prediction}).<span class="fn">json</span>()

<span class="kw">def</span> <span class="fn">swap_tokens</span>(from_token: <span class="cls">str</span>, to_token: <span class="cls">str</span>, amount: <span class="cls">float</span>) -> <span class="cls">dict</span>:
    <span class="st">"""Swap tokens via Purple Flea DEX. Returns execution price and output amount."""</span>
    <span class="kw">return</span> requests.<span class="fn">post</span>(<span class="st">f"{PF_BASE}/swap"</span>, headers=H,
        json={<span class="st">"from"</span>: from_token, <span class="st">"to"</span>: to_token,
              <span class="st">"amount"</span>: amount}).<span class="fn">json</span>()

<span class="kw">def</span> <span class="fn">register_domain</span>(name: <span class="cls">str</span>, tld: <span class="cls">str</span>, years: <span class="cls">int</span> = <span class="num">1</span>) -> <span class="cls">dict</span>:
    <span class="st">"""Register a domain name for 1-10 years. tld examples: 'eth', 'com', 'xyz'."""</span>
    <span class="kw">return</span> requests.<span class="fn">post</span>(<span class="st">f"{PF_BASE}/domains/register"</span>, headers=H,
        json={<span class="st">"name"</span>: name, <span class="st">"tld"</span>: tld, <span class="st">"years"</span>: years}).<span class="fn">json</span>()

<span class="cm"># â”€â”€ ReAct Agent â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

agent = dspy.ReAct(
    <span class="st">"""You are an autonomous financial agent with access to a crypto wallet,
    perpetual futures markets, a provably fair casino, and domain registration.
    Analyze the user's goal, check relevant balances and prices, then take the
    most appropriate action. Always reason about risk before executing trades
    or bets. Apply Kelly criterion for bet sizing."""</span>,
    tools=[
        get_balance,
        get_market_price,
        open_position,
        close_position,
        place_bet,
        swap_tokens,
        register_domain,
    ],
    max_iters=<span class="num">8</span>
)

<span class="cm"># Run with a natural language goal</span>
result = agent(goal=<span class="st">"Check my ETH balance, then open a small BTC-PERP long "</span>
                    <span class="st">"if 24h momentum is positive. Use 3x leverage max."</span>)
<span class="fn">print</span>(result.answer)
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- OPTIMIZER PATTERN -->
<section id="optimizer">
  <div class="container">
    <div class="reveal">
      <div class="section-label">DSPy Optimizer Pattern</div>
      <h2 class="section-title">Optimize the agent's prompts using<br>Purple Flea API outcomes as signal.</h2>
      <p class="section-desc">
        The optimizer is what separates DSPy from every other agent framework. Feed it historical trade data as a training set, define profitability as the metric, and MIPRO will automatically rewrite your module's instructions and demonstrations to maximize it.
      </p>
    </div>

    <div class="reveal reveal-delay-1">
      <div class="code-block">
        <div class="code-header">
          <div class="code-dot red"></div>
          <div class="code-dot yellow"></div>
          <div class="code-dot green"></div>
          <span class="code-filename">optimize.py &mdash; MIPRO optimizer with P&amp;L metric</span>
        </div>
<span class="kw">import</span> dspy
<span class="kw">from</span> dspy.teleprompt <span class="kw">import</span> MIPROv2

<span class="cm"># â”€â”€ Training set from historical Purple Flea API outcomes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="cm"># Each Example includes the inputs your module receives and the</span>
<span class="cm"># ground-truth output that produced a profitable outcome historically.</span>

trainset = [
    dspy.Example(
        market=<span class="st">"BTC-PERP"</span>,
        price=<span class="num">67450.0</span>,
        change_24h=<span class="num">+3.2</span>,
        funding_rate=<span class="num">0.0001</span>,
        portfolio_eth=<span class="num">5.0</span>,
        max_risk_pct=<span class="num">2.0</span>,
        action=<span class="st">"buy"</span>,
        size_usd=<span class="num">800.0</span>,
        leverage=<span class="num">3</span>,
    ).<span class="fn">with_inputs</span>(<span class="st">"market"</span>, <span class="st">"price"</span>, <span class="st">"change_24h"</span>,
                    <span class="st">"funding_rate"</span>, <span class="st">"portfolio_eth"</span>, <span class="st">"max_risk_pct"</span>),

    dspy.Example(
        market=<span class="st">"ETH-PERP"</span>,
        price=<span class="num">3210.0</span>,
        change_24h=<span class="num">-2.8</span>,
        funding_rate=<span class="num">-0.0003</span>,
        portfolio_eth=<span class="num">5.0</span>,
        max_risk_pct=<span class="num">2.0</span>,
        action=<span class="st">"hold"</span>,
        size_usd=<span class="num">0.0</span>,
        leverage=<span class="num">1</span>,
    ).<span class="fn">with_inputs</span>(<span class="st">"market"</span>, <span class="st">"price"</span>, <span class="st">"change_24h"</span>,
                    <span class="st">"funding_rate"</span>, <span class="st">"portfolio_eth"</span>, <span class="st">"max_risk_pct"</span>),
    <span class="cm"># ... collect 50-200 examples from your Purple Flea trade history</span>
]

<span class="cm"># â”€â”€ Metric function: reward profitable decisions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="kw">def</span> <span class="fn">profitability_metric</span>(example, prediction, trace=<span class="kw">None</span>) -> <span class="cls">float</span>:
    <span class="st">"""
    Score: +1.0 if action matches known profitable outcome
           +0.5 if hold when market moved against predicted direction
           -1.0 if action matches a losing outcome
    """</span>
    <span class="kw">if</span> prediction.action == example.action:
        <span class="kw">return</span> <span class="num">1.0</span>
    <span class="kw">elif</span> prediction.action == <span class="st">"hold"</span> <span class="kw">and</span> example.action == <span class="st">"hold"</span>:
        <span class="kw">return</span> <span class="num">0.5</span>
    <span class="kw">return</span> <span class="num">0.0</span>

<span class="cm"># â”€â”€ Compile with MIPROv2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
trader = <span class="cls">TradingAgent</span>(max_risk_pct=<span class="num">2.0</span>)

optimizer = MIPROv2(
    metric=profitability_metric,
    num_candidates=<span class="num">15</span>,    <span class="cm"># prompts to try per parameter</span>
    num_threads=<span class="num">4</span>,         <span class="cm"># parallel LM calls during search</span>
    verbose=<span class="kw">True</span>
)

optimized_trader = optimizer.<span class="fn">compile</span>(
    trader,
    trainset=trainset,
    num_trials=<span class="num">30</span>,         <span class="cm"># Bayesian optimization steps</span>
    minibatch_size=<span class="num">25</span>
)

<span class="cm"># Save the compiled program â€” includes optimized instructions + demos</span>
optimized_trader.<span class="fn">save</span>(<span class="st">"optimized_trader.json"</span>)

<span class="cm"># Load and use in production</span>
production_trader = <span class="cls">TradingAgent</span>()
production_trader.<span class="fn">load</span>(<span class="st">"optimized_trader.json"</span>)
result = production_trader.<span class="fn">forward</span>(market=<span class="st">"SOL-PERP"</span>)
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- EVALUATION -->
<section id="evaluation">
  <div class="container">
    <div class="reveal">
      <div class="section-label">Evaluation</div>
      <h2 class="section-title">Measuring agent profitability<br>as a DSPy metric.</h2>
      <p class="section-desc">
        DSPy evaluators let you score your agent against a held-out test set before deploying. For financial agents, the metric is P&amp;L. Pull historical outcomes from Purple Flea's trade history endpoint to build a ground-truth evaluation set.
      </p>
    </div>

    <div class="split reveal reveal-delay-1">
      <div class="code-block">
        <div class="code-header">
          <div class="code-dot red"></div>
          <div class="code-dot yellow"></div>
          <div class="code-dot green"></div>
          <span class="code-filename">evaluate.py</span>
        </div>
<span class="kw">import</span> dspy
<span class="kw">from</span> dspy.evaluate <span class="kw">import</span> Evaluate
<span class="kw">import</span> requests

<span class="cm"># Pull trade history from Purple Flea</span>
history = requests.<span class="fn">get</span>(
    <span class="st">"https://api.purpleflea.com/trading/history"</span>,
    headers={<span class="st">"X-API-Key"</span>: PF_KEY},
    params={<span class="st">"limit"</span>: <span class="num">200</span>}
).<span class="fn">json</span>()[<span class="st">"trades"</span>]

<span class="cm"># Convert to DSPy examples</span>
testset = []
<span class="kw">for</span> trade <span class="kw">in</span> history[<span class="num">-50</span>:]:   <span class="cm"># last 50 trades as test set</span>
    testset.<span class="fn">append</span>(dspy.Example(
        market=trade[<span class="st">"market"</span>],
        price=trade[<span class="st">"entry_price"</span>],
        change_24h=trade[<span class="st">"change_24h_at_entry"</span>],
        funding_rate=trade[<span class="st">"funding_rate"</span>],
        portfolio_eth=trade[<span class="st">"portfolio_eth"</span>],
        max_risk_pct=<span class="num">2.0</span>,
        <span class="cm"># Ground truth: did this trade close profitable?</span>
        was_profitable=trade[<span class="st">"pnl_eth"</span>] > <span class="num">0</span>,
        expected_action=<span class="st">"buy"</span> <span class="kw">if</span> trade[<span class="st">"side"</span>] == <span class="st">"buy"</span> <span class="kw">else</span> <span class="st">"sell"</span>
    ).<span class="fn">with_inputs</span>(
        <span class="st">"market"</span>, <span class="st">"price"</span>, <span class="st">"change_24h"</span>,
        <span class="st">"funding_rate"</span>, <span class="st">"portfolio_eth"</span>, <span class="st">"max_risk_pct"</span>
    ))

<span class="cm"># Run evaluation</span>
evaluator = Evaluate(
    devset=testset,
    num_threads=<span class="num">4</span>,
    display_progress=<span class="kw">True</span>,
    display_table=<span class="num">5</span>
)

<span class="cm"># Compare baseline vs optimized</span>
baseline_score = evaluator(
    <span class="cls">TradingAgent</span>(), metric=profitability_metric
)
optimized_score = evaluator(
    production_trader, metric=profitability_metric
)

<span class="fn">print</span>(<span class="st">f"Baseline:  {baseline_score:.1f}%"</span>)
<span class="fn">print</span>(<span class="st">f"Optimized: {optimized_score:.1f}%"</span>)
<span class="fn">print</span>(<span class="st">f"Delta:     +{optimized_score - baseline_score:.1f}%"</span>)
        </div>
      <div>
        <div class="card" style="margin-bottom:20px;">
          <h3 style="margin-bottom:10px;">What to measure</h3>
          <p>Use Purple Flea's <ic>/trading/history</ic> and <ic>/casino/history</ic> endpoints to pull historical outcomes. Build metrics around net P&amp;L, Sharpe ratio, win rate, or max drawdown depending on your agent's objective.</p>
        </div>
        <div class="card" style="margin-bottom:20px;">
          <h3 style="margin-bottom:10px;">Train/test split</h3>
          <p>Reserve the most recent 20-30% of trades as a test set. The optimizer never sees test data. This gives you an honest measure of whether optimized prompts generalize to new market conditions.</p>
        </div>
        <div class="card">
          <h3 style="margin-bottom:10px;">Iterative improvement</h3>
          <p>After deploying, collect new outcomes, add them to the training set, and re-run the optimizer monthly. The agent's prompts continuously improve as it accumulates live trading data from Purple Flea.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- ADVANCED: MULTI-AGENT -->
<section id="multi-agent">
  <div class="container">
    <div class="reveal">
      <div class="section-label">Advanced</div>
      <h2 class="section-title">Multi-agent DSPy orchestration<br>with shared Purple Flea accounts.</h2>
      <p class="section-desc">
        DSPy supports multi-agent programs where one module calls another as a sub-agent. For financial systems, you can orchestrate a portfolio manager, a casino agent, and a market analyst as independent DSPy modules sharing a single Purple Flea API key.
      </p>
    </div>

    <div class="reveal reveal-delay-1">
      <div class="code-block">
        <div class="code-header">
          <div class="code-dot red"></div>
          <div class="code-dot yellow"></div>
          <div class="code-dot green"></div>
          <span class="code-filename">multi_agent.py &mdash; orchestrated financial agents</span>
        </div>
<span class="kw">import</span> dspy

<span class="cm"># â”€â”€ Specialist sub-agents â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

<span class="kw">class</span> <span class="cls">MarketAnalyst</span>(dspy.Module):
    <span class="st">"""Analyzes market data and produces a directional thesis."""</span>
    <span class="kw">def</span> <span class="fn">__init__</span>(self):
        self.analyze = dspy.ChainOfThought(
            <span class="st">"market_data: str, news_summary: str -> "</span>
            <span class="st">"direction: str, confidence: float, reasoning: str"</span>
        )
    <span class="kw">def</span> <span class="fn">forward</span>(self, market_data, news_summary):
        <span class="kw">return</span> self.analyze(
            market_data=market_data,
            news_summary=news_summary
        )

<span class="kw">class</span> <span class="cls">RiskManager</span>(dspy.Module):
    <span class="st">"""Validates proposed actions against portfolio risk limits."""</span>
    <span class="kw">def</span> <span class="fn">__init__</span>(self):
        self.validate = dspy.Predict(
            <span class="st">"proposed_action: str, portfolio_state: str, "</span>
            <span class="st">"risk_limits: str -> approved: bool, adjusted_action: str, reason: str"</span>
        )
    <span class="kw">def</span> <span class="fn">forward</span>(self, proposed_action, portfolio_state, risk_limits):
        <span class="kw">return</span> self.validate(
            proposed_action=proposed_action,
            portfolio_state=portfolio_state,
            risk_limits=risk_limits
        )

<span class="cm"># â”€â”€ Portfolio manager orchestrates sub-agents â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

<span class="kw">class</span> <span class="cls">PortfolioManager</span>(dspy.Module):
    <span class="kw">def</span> <span class="fn">__init__</span>(self):
        self.analyst      = <span class="cls">MarketAnalyst</span>()
        self.risk_manager = <span class="cls">RiskManager</span>()
        self.trader       = <span class="cls">TradingAgent</span>(max_risk_pct=<span class="num">1.5</span>)
        self.casino       = <span class="cls">CasinoAgent</span>(kelly_fraction=<span class="num">0.1</span>)
        self.decide       = dspy.ReAct(
            <span class="st">"Given analyst thesis and risk approval, allocate capital optimally"</span>,
            tools=[get_balance, open_position, place_bet, swap_tokens]
        )

    <span class="kw">def</span> <span class="fn">forward</span>(self, market: <span class="cls">str</span>, news: <span class="cls">str</span>):
        <span class="cm"># Step 1: analyst forms a thesis</span>
        price_data = <span class="cls">str</span>(get_market_price(market))
        thesis = self.analyst.<span class="fn">forward</span>(
            market_data=price_data,
            news_summary=news
        )

        <span class="cm"># Step 2: risk manager validates the proposed position</span>
        portfolio = <span class="cls">str</span>(get_balance())
        approval  = self.risk_manager.<span class="fn">forward</span>(
            proposed_action=<span class="st">f"{thesis.direction} on {market}"</span>,
            portfolio_state=portfolio,
            risk_limits=<span class="st">"Max 1.5% per trade, max 3 open positions, no leverage > 5x"</span>
        )

        <span class="kw">if not</span> approval.approved:
            <span class="kw">return</span> dspy.Prediction(
                action=<span class="st">"blocked"</span>, reason=approval.reason
            )

        <span class="cm"># Step 3: orchestrator executes the approved action</span>
        result = self.decide(
            goal=<span class="st">f"Execute: {approval.adjusted_action}. "</span>
                 <span class="st">f"Analyst confidence: {thesis.confidence:.0%}. "</span>
                 <span class="st">f"Reasoning: {thesis.reasoning}"</span>
        )
        <span class="kw">return</span> dspy.Prediction(
            action=approval.adjusted_action,
            thesis=thesis.reasoning,
            result=result.answer
        )

<span class="cm"># Run the orchestrator</span>
dspy.configure(lm=dspy.LM(<span class="st">"openai/gpt-4o"</span>))
manager = <span class="cls">PortfolioManager</span>()
outcome = manager.<span class="fn">forward</span>(
    market=<span class="st">"BTC-PERP"</span>,
    news=<span class="st">"Fed holds rates steady, Bitcoin ETF inflows hit $800M today"</span>
)
<span class="fn">print</span>(outcome.result)
      </div>
    </div>

    <div class="grid-3 reveal reveal-delay-2" style="margin-top:40px;">
      <div class="card">
        <div class="card-icon purple">&#9783;</div>
        <h3>Independent optimization</h3>
        <p>Each sub-agent &mdash; analyst, risk manager, trader &mdash; can be optimized independently with its own training set and metric. Compose optimized specialists for better overall performance.</p>
      </div>
      <div class="card">
        <div class="card-icon blue">&#8644;</div>
        <h3>Shared API key</h3>
        <p>All sub-agents share one Purple Flea API key. The portfolio manager controls capital allocation centrally while specialists focus on their domain tasks.</p>
      </div>
      <div class="card">
        <div class="card-icon green">&#9651;</div>
        <h3>Traceable decisions</h3>
        <p>DSPy's trace captures every module call, tool use, and intermediate output. Audit exactly why your portfolio manager made each financial decision.</p>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- INTEGRATIONS -->
<section>
  <div class="container">
    <div class="reveal">
      <div class="section-label">Also available</div>
      <h2 class="section-title">More agent integrations.</h2>
    </div>
    <div class="related-grid reveal reveal-delay-1">
      <a href="/for-langchain/" class="related-card">
        <div class="label">LangChain</div>
        <div class="title">Purple Flea for LangChain</div>
        <div class="desc">BaseTool wrappers for LangChain agents and LCEL</div>
      </a>
      <a href="/for-crewai/" class="related-card">
        <div class="label">CrewAI</div>
        <div class="title">Purple Flea for CrewAI</div>
        <div class="desc">Multi-agent crews with financial tool access</div>
      </a>
      <a href="/for-smolagents/" class="related-card">
        <div class="label">smolagents</div>
        <div class="title">Purple Flea for smolagents</div>
        <div class="desc">HuggingFace agent tools for financial APIs</div>
      </a>
    </div>
  </div>
</section>

<!-- CTA -->
<section class="cta-section">
  <div class="container">
    <div class="cta-box reveal">
      <h2>Build financial DSPy agents<br><span style="color:var(--purple)">that actually optimize.</span></h2>
      <p>Register free. Get an API key. Start building DSPy programs with real wallets, 275 perpetual markets, and a provably fair casino.</p>
      <div class="cta-links">
        <a href="https://wallet.purpleflea.com" target="_blank" class="btn-primary">Register your agent &rarr;</a>
        <a href="https://dspy.ai" target="_blank" class="btn-secondary">DSPy documentation &nearr;</a>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<footer>
  <div class="container">
    <div class="footer-top">
      <div class="footer-brand">
        <a href="/" class="nav-logo">
          <div class="nav-logo-icon">&#9830;</div>
          Purple Flea
        </a>
        <p>AI-first financial infrastructure for autonomous agents. Built for machines, verified by math.</p>
      </div>
      <div class="footer-columns">
        <div class="footer-col">
          <h4>Products</h4>
          <ul>
            <li><a href="https://casino.purpleflea.com" target="_blank">Casino</a></li>
            <li><a href="https://trading.purpleflea.com" target="_blank">Trading</a></li>
            <li><a href="https://wallet.purpleflea.com" target="_blank">Wallet</a></li>
            <li><a href="https://domains.purpleflea.com" target="_blank">Domains</a></li>
            <li><a href="/crypto-wallet-api/">Wallet API Docs</a></li>
            <li><a href="/trading-api/">Trading API Docs</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Developers</h4>
          <ul>
            <li><a href="/docs">Docs</a></li>
            <li><a href="/for-agents">For Agents</a></li>
            <li><a href="/for-langchain/">LangChain</a></li>
            <li><a href="/for-crewai/">CrewAI</a></li>
            <li><a href="/for-smolagents/">smolagents</a></li>
            <li><a href="/for-dspy/">DSPy</a></li>
            <li><a href="/quick-start">Quick Start</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Company</h4>
          <ul>
            <li><a href="/pricing">Pricing</a></li>
            <li><a href="/stats">Stats</a></li>
            <li><a href="/changelog">Changelog</a></li>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="mailto:hello@purpleflea.com">Contact</a></li>
            <li><a href="https://github.com/Purple-flea" target="_blank">GitHub</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2026 Purple Flea. All rights reserved.</p>
      <div class="footer-social">
        <a href="https://github.com/Purple-flea" target="_blank">GitHub</a>
        <a href="https://x.com/purpleflea" target="_blank">X / Twitter</a>
      </div>
    </div>
  </div>
</footer>

<script>
const navbar = document.getElementById('navbar');
window.addEventListener('scroll', () => {
  navbar.classList.toggle('scrolled', window.scrollY > 50);
});
const revealEls = document.querySelectorAll('.reveal');
const revealObs = new IntersectionObserver((entries) => {
  entries.forEach(e => {
    if (e.isIntersecting) { e.target.classList.add('visible'); revealObs.unobserve(e.target); }
  });
}, { threshold: 0.08, rootMargin: '0px 0px -40px 0px' });
revealEls.forEach(el => revealObs.observe(el));
</script>
</body>
</html>
