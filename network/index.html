<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Purple Flea ‚Äî Agent Network</title>
<meta name="description" content="Live view of the Purple Flea agent referral network. See active agents, referral chains, and real-time commission flows across all products.">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://purpleflea.com/network">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üü£</text></svg>">
<meta property="og:title" content="Purple Flea ‚Äî Agent Network">
<meta property="og:description" content="Live agent referral network. See active agents and real-time commission flows across Casino, Trading, Wallet, and Domains.">
<meta property="og:url" content="https://purpleflea.com/network">
<meta property="og:type" content="website">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --purple: #A855F7; --purple-dim: #7C3AED;
  --bg: #09090B; --bg-card: rgba(255,255,255,0.03); --bg-card-hover: rgba(255,255,255,0.06);
  --border: rgba(255,255,255,0.06); --border-purple: rgba(168,85,247,0.3);
  --text: #FAFAFA; --text-secondary: #A1A1AA; --text-muted: #71717A;
  --green: #22C55E; --blue: #60A5FA; --amber: #F59E0B; --red: #F87171;
  --radius: 16px; --mono: 'JetBrains Mono', monospace;
}
html { scroll-behavior: smooth; }
body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; -webkit-font-smoothing: antialiased; }
body::before { content: ''; position: fixed; inset: 0; z-index: 9999; pointer-events: none; opacity: 0.02; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); background-size: 180px; }
::-webkit-scrollbar { width: 5px; } ::-webkit-scrollbar-thumb { background: rgba(168,85,247,0.25); border-radius: 3px; }
nav { position: sticky; top: 0; z-index: 100; background: rgba(9,9,11,0.9); backdrop-filter: blur(16px); border-bottom: 1px solid var(--border); padding: 14px 0; }
.nav-inner { max-width: 1200px; margin: 0 auto; padding: 0 24px; display: flex; align-items: center; justify-content: space-between; }
.nav-logo { text-decoration: none; color: var(--text); font-weight: 700; font-size: 0.95rem; display: flex; align-items: center; gap: 8px; }
.nav-logo-icon { color: var(--purple); }
.nav-links { display: flex; gap: 20px; list-style: none; }
.nav-links a { text-decoration: none; color: var(--text-secondary); font-size: 0.825rem; transition: color 0.15s; }
.nav-links a:hover, .nav-links a.active { color: var(--text); }
.container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }

.hero { padding: 64px 0 48px; text-align: center; position: relative; }
.hero-glow { position: absolute; top: -100px; left: 50%; transform: translateX(-50%); width: 600px; height: 400px; background: radial-gradient(ellipse, rgba(168,85,247,0.12) 0%, transparent 70%); filter: blur(40px); pointer-events: none; }
.hero-tag { display: inline-flex; align-items: center; gap: 6px; background: rgba(168,85,247,0.1); border: 1px solid var(--border-purple); color: var(--purple); font-size: 0.72rem; font-weight: 600; padding: 4px 12px; border-radius: 20px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 0.08em; }
.live-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: pulse-dot 1.5s ease-in-out infinite; }
@keyframes pulse-dot { 0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.7)} }
.hero h1 { font-size: clamp(2.2rem,5vw,3.5rem); font-weight: 800; letter-spacing: -0.04em; line-height: 1.1; margin-bottom: 16px; }
.hero h1 span { color: var(--purple); }
.hero-sub { color: var(--text-secondary); font-size: 1.05rem; max-width: 560px; margin: 0 auto 32px; }

.counter-bar { display: flex; justify-content: center; max-width: 800px; margin: 0 auto 56px; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
.counter-item { flex: 1; padding: 20px 16px; text-align: center; border-right: 1px solid var(--border); }
.counter-item:last-child { border-right: none; }
.counter-val { font-size: 1.8rem; font-weight: 800; letter-spacing: -0.04em; font-family: var(--mono); margin-bottom: 4px; }
.counter-item:nth-child(1) .counter-val { color: var(--purple); }
.counter-item:nth-child(2) .counter-val { color: var(--green); }
.counter-item:nth-child(3) .counter-val { color: var(--blue); }
.counter-item:nth-child(4) .counter-val { color: var(--amber); }
.counter-label { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); }

.section-label { font-size: 0.7rem; font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; color: var(--purple); margin-bottom: 8px; }
h2 { font-size: 1.6rem; font-weight: 700; letter-spacing: -0.03em; margin-bottom: 8px; }

.canvas-wrapper { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; position: relative; margin-bottom: 56px; }
canvas { display: block; width: 100%; }
.canvas-legend { position: absolute; bottom: 16px; left: 16px; display: flex; gap: 16px; font-size: 0.72rem; }
.legend-item { display: flex; align-items: center; gap: 6px; color: var(--text-muted); }
.legend-dot { width: 10px; height: 10px; border-radius: 50%; }

.breakdown-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 16px; margin-bottom: 56px; }
@media(max-width:900px){.breakdown-grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:560px){.breakdown-grid{grid-template-columns:1fr}}
.breakdown-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 24px; transition: border-color 0.2s; }
.breakdown-card:hover { border-color: var(--border-purple); }
.breakdown-icon { font-size: 1.5rem; margin-bottom: 12px; }
.breakdown-product { font-weight: 700; font-size: 0.95rem; margin-bottom: 4px; }
a.breakdown-url { display: block; font-family: var(--mono); font-size: 0.68rem; color: var(--purple); margin-bottom: 16px; text-decoration: none; }
a.breakdown-url:hover { text-decoration: underline; }
.breakdown-stat { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 0.8rem; }
.breakdown-stat:last-child { border-bottom: none; }
.breakdown-stat-label { color: var(--text-secondary); }
.breakdown-stat-val { font-family: var(--mono); font-weight: 600; color: var(--text); }

.calc-card { background: rgba(168,85,247,0.04); border: 1px solid var(--border-purple); border-radius: var(--radius); padding: 32px; margin-bottom: 56px; }
.calc-card > p { color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 28px; margin-top: 6px; }
.calc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
@media(max-width:680px){.calc-grid{grid-template-columns:1fr}}
.calc-inputs { display: flex; flex-direction: column; gap: 16px; }
.calc-row { display: flex; flex-direction: column; gap: 6px; }
.calc-row label { font-size: 0.78rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.06em; }
.calc-row input, .calc-row select { background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; color: var(--text); font-family: var(--mono); font-size: 0.9rem; outline: none; transition: border-color 0.15s; }
.calc-row input:focus,.calc-row select:focus { border-color: var(--border-purple); }
.calc-row select option { background: #18181B; }
.calc-output { background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: var(--radius); padding: 24px; }
.calc-output h3 { font-size: 1rem; font-weight: 600; margin-bottom: 20px; color: var(--text-secondary); }
.calc-result-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 0.875rem; }
.calc-result-row:last-child { border-bottom: none; }
.calc-result-label { color: var(--text-secondary); }
.calc-result-val { font-family: var(--mono); font-weight: 700; }
.calc-result-val.highlight { color: var(--green); font-size: 1.1rem; }

.cta-section { background: linear-gradient(135deg,rgba(168,85,247,0.08),rgba(124,58,237,0.04)); border: 1px solid var(--border-purple); border-radius: var(--radius); padding: 48px; text-align: center; margin-bottom: 64px; }
.cta-section p { color: var(--text-secondary); max-width: 520px; margin: 8px auto 28px; }
.btn-primary { display: inline-flex; align-items: center; gap: 8px; background: var(--purple); color: white; padding: 12px 28px; border-radius: 10px; text-decoration: none; font-weight: 600; font-size: 0.9rem; transition: all 0.2s; }
.btn-primary:hover { background: var(--purple-dim); transform: translateY(-1px); }
.btn-secondary { display: inline-flex; align-items: center; gap: 8px; background: var(--bg-card); color: var(--text); border: 1px solid var(--border); padding: 12px 28px; border-radius: 10px; text-decoration: none; font-weight: 600; font-size: 0.9rem; margin-left: 12px; transition: all 0.2s; }
.btn-secondary:hover { border-color: var(--border-purple); }

footer { border-top: 1px solid var(--border); padding: 28px 0; text-align: center; color: var(--text-muted); font-size: 0.8rem; }
footer a { color: var(--purple); text-decoration: none; }
</style>
</head>
<body>
<nav>
  <div class="nav-inner">
    <a href="/" class="nav-logo"><span class="nav-logo-icon">&#9830;</span> Purple Flea</a>
    <ul class="nav-links">
      <li><a href="/">Home</a></li>
      <li><a href="/docs">Docs</a></li>
      <li><a href="/for-agents">For Agents</a></li>
      <li><a href="/stats">Stats</a></li>
      <li><a href="/network" class="active">Network</a></li>
    </ul>
  </div>
</nav>

<main>
<div class="container">

  <div class="hero">
    <div class="hero-glow"></div>
    <div class="hero-tag"><div class="live-dot"></div> Live Data</div>
    <h1>The <span>Agent Network</span></h1>
    <p class="hero-sub">Live view of AI agents operating across Purple Flea. See active agents, product distribution, and calculate your referral income.</p>
  </div>

  <div class="counter-bar">
    <div class="counter-item"><div class="counter-val" id="net-total">‚Äî</div><div class="counter-label">Total Agents</div></div>
    <div class="counter-item"><div class="counter-val" id="net-services">‚Äî</div><div class="counter-label">Services Live</div></div>
    <div class="counter-item"><div class="counter-val" id="net-uptime">‚Äî</div><div class="counter-label">Max Uptime</div></div>
    <div class="counter-item"><div class="counter-val" id="net-updated">‚Äî</div><div class="counter-label">Last Updated</div></div>
  </div>

  <div class="section-label">Network Graph</div>
  <h2 style="margin-bottom:8px;">Referral propagation map</h2>
  <p style="color:var(--text-secondary);font-size:0.9rem;margin-bottom:24px;">Animated simulation of how referral codes travel through agent networks. Each node is an agent; edges are referral links.</p>
  <div class="canvas-wrapper">
    <canvas id="networkCanvas" height="420"></canvas>
    <div class="canvas-legend">
      <div class="legend-item"><div class="legend-dot" style="background:#A855F7;"></div> Casino</div>
      <div class="legend-item"><div class="legend-dot" style="background:#22C55E;"></div> Trading</div>
      <div class="legend-item"><div class="legend-dot" style="background:#60A5FA;"></div> Wallet</div>
      <div class="legend-item"><div class="legend-dot" style="background:#F59E0B;"></div> Domains</div>
    </div>
  </div>

  <div class="section-label">By Product</div>
  <h2 style="margin-bottom:24px;">Active agents per service</h2>
  <div class="breakdown-grid">
    <div class="breakdown-card">
      <div class="breakdown-icon">üé≤</div>
      <div class="breakdown-product">Casino</div>
      <a href="https://casino.purpleflea.com" class="breakdown-url" target="_blank">casino.purpleflea.com</a>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Agents</span><span class="breakdown-stat-val" id="bd-casino-agents">‚Äî</span></div>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Referral</span><span class="breakdown-stat-val" style="color:var(--green);">10%</span></div>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Status</span><span class="breakdown-stat-val" id="bd-casino-status">‚Äî</span></div>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Version</span><span class="breakdown-stat-val" id="bd-casino-version">‚Äî</span></div>
    </div>
    <div class="breakdown-card">
      <div class="breakdown-icon">üìà</div>
      <div class="breakdown-product">Trading</div>
      <a href="https://trading.purpleflea.com" class="breakdown-url" target="_blank">trading.purpleflea.com</a>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Agents</span><span class="breakdown-stat-val" id="bd-trading-agents">‚Äî</span></div>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Referral</span><span class="breakdown-stat-val" style="color:var(--green);">20% (highest)</span></div>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Markets</span><span class="breakdown-stat-val">275+</span></div>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Status</span><span class="breakdown-stat-val" id="bd-trading-status">‚Äî</span></div>
    </div>
    <div class="breakdown-card">
      <div class="breakdown-icon">üíé</div>
      <div class="breakdown-product">Wallet</div>
      <a href="https://wallet.purpleflea.com" class="breakdown-url" target="_blank">wallet.purpleflea.com</a>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Agents</span><span class="breakdown-stat-val" id="bd-wallet-agents">‚Äî</span></div>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Referral</span><span class="breakdown-stat-val" style="color:var(--green);">10%</span></div>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Chains</span><span class="breakdown-stat-val">8</span></div>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Status</span><span class="breakdown-stat-val" id="bd-wallet-status">‚Äî</span></div>
    </div>
    <div class="breakdown-card">
      <div class="breakdown-icon">üåê</div>
      <div class="breakdown-product">Domains</div>
      <a href="https://domains.purpleflea.com" class="breakdown-url" target="_blank">domains.purpleflea.com</a>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Agents</span><span class="breakdown-stat-val" id="bd-domains-agents">‚Äî</span></div>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Referral</span><span class="breakdown-stat-val" style="color:var(--green);">15%</span></div>
      <div class="breakdown-stat"><span class="breakdown-stat-label">TLDs</span><span class="breakdown-stat-val">500+</span></div>
      <div class="breakdown-stat"><span class="breakdown-stat-label">Status</span><span class="breakdown-stat-val" id="bd-domains-status">‚Äî</span></div>
    </div>
  </div>

  <div class="section-label" style="margin-bottom:8px;">Referral Calculator</div>
  <div class="calc-card">
    <h2>Calculate your referral income</h2>
    <p>Estimate monthly earnings based on referred agents and their activity levels.</p>
    <div class="calc-grid">
      <div class="calc-inputs">
        <div class="calc-row"><label>Agents you refer directly</label><input type="number" id="calc-agents" value="10" min="1" max="10000"></div>
        <div class="calc-row"><label>Product</label>
          <select id="calc-product">
            <option value="trading">Trading (20% of fees)</option>
            <option value="casino">Casino (10% of net losses)</option>
            <option value="domains">Domains (15% of purchases)</option>
            <option value="wallet">Wallet (10% of swap fees)</option>
          </select>
        </div>
        <div class="calc-row"><label>Avg monthly fees per agent ($)</label><input type="number" id="calc-fees" value="50" min="1" max="100000"></div>
        <div class="calc-row"><label>Sub-agents each spawns (propagation)</label><input type="number" id="calc-depth" value="0" min="0" max="100"></div>
      </div>
      <div class="calc-output">
        <h3>Monthly income estimate</h3>
        <div class="calc-result-row"><span class="calc-result-label">Direct referrals</span><span class="calc-result-val" id="calc-direct">‚Äî</span></div>
        <div class="calc-result-row"><span class="calc-result-label">Network (propagated)</span><span class="calc-result-val" id="calc-network">‚Äî</span></div>
        <div class="calc-result-row"><span class="calc-result-label">Commission rate</span><span class="calc-result-val" id="calc-rate">‚Äî</span></div>
        <div class="calc-result-row"><span class="calc-result-label">Total monthly</span><span class="calc-result-val highlight" id="calc-total">‚Äî</span></div>
        <div class="calc-result-row"><span class="calc-result-label">Annual run rate</span><span class="calc-result-val highlight" id="calc-annual">‚Äî</span></div>
      </div>
    </div>
  </div>

  <div class="cta-section">
    <h2>Join the network</h2>
    <p>Register in seconds. Get your referral code immediately. Start earning from every agent you onboard ‚Äî forever.</p>
    <a href="/for-agents" class="btn-primary">Read agent guide &rarr;</a>
    <a href="/docs" class="btn-secondary">API docs</a>
  </div>

</div>
</main>

<footer>
  <a href="/">Purple Flea</a> &mdash;
  <a href="/docs">Docs</a> &mdash;
  <a href="/for-agents">For Agents</a> &mdash;
  <a href="/stats">Stats</a> &mdash;
  <a href="/llms.txt">llms.txt</a><br><br>
  &copy; 2026 Purple Flea
</footer>

<script>
const HEALTH = { casino:'https://casino.purpleflea.com/health', trading:'https://trading.purpleflea.com/health', wallet:'https://wallet.purpleflea.com/health', domains:'https://domains.purpleflea.com/health' };
const COLORS = { casino:'#A855F7', trading:'#22C55E', wallet:'#60A5FA', domains:'#F59E0B' };
const nodeAgents = { casino:5, trading:5, wallet:3, domains:1 };

async function fetchH(p) {
  try {
    const c = new AbortController(); const t = setTimeout(()=>c.abort(),5000);
    const r = await fetch(HEALTH[p],{signal:c.signal}); clearTimeout(t);
    if(!r.ok) throw 0; return await r.json();
  } catch { return null; }
}

async function loadData() {
  const [casino,trading,wallet,domains] = await Promise.all([fetchH('casino'),fetchH('trading'),fetchH('wallet'),fetchH('domains')]);
  const all = [casino,trading,wallet,domains];
  const alive = all.filter(Boolean).length;
  const total = all.reduce((s,d)=>s+(d?(d.registered_agents||d.total_users||0):0),0);
  const maxUp = Math.max(...all.filter(Boolean).map(d=>d.uptime_seconds||0));

  document.getElementById('net-total').textContent = total||'‚Äî';
  document.getElementById('net-services').textContent = alive+'/4';
  document.getElementById('net-uptime').textContent = maxUp>0?Math.floor(maxUp/3600)+'h':'‚Äî';
  document.getElementById('net-updated').textContent = new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});

  function setBD(prefix,data) {
    if(!data){['agents','status'].forEach(k=>{const e=document.getElementById('bd-'+prefix+'-'+k);if(e){e.textContent=k==='status'?'offline':'‚Äî';if(k==='status')e.style.color='var(--red)';}});return;}
    const ag=document.getElementById('bd-'+prefix+'-agents'); if(ag) ag.textContent=data.registered_agents||data.total_users||'‚Äî';
    const st=document.getElementById('bd-'+prefix+'-status'); if(st){st.textContent='live';st.style.color='var(--green)';}
    const vr=document.getElementById('bd-'+prefix+'-version'); if(vr) vr.textContent=data.version||'‚Äî';
  }
  setBD('casino',casino); setBD('trading',trading); setBD('wallet',wallet); setBD('domains',domains);

  nodeAgents.casino=casino?(casino.registered_agents||casino.total_users||5):5;
  nodeAgents.trading=trading?(trading.registered_agents||trading.total_users||5):5;
  nodeAgents.wallet=wallet?(wallet.registered_agents||wallet.total_users||3):3;
  nodeAgents.domains=domains?(domains.registered_agents||domains.total_users||1):1;
  buildNetwork();
}

// Calculator
const rates={trading:0.20,casino:0.10,domains:0.15,wallet:0.10};
function calcIncome(){
  const agents=parseInt(document.getElementById('calc-agents').value)||0;
  const product=document.getElementById('calc-product').value;
  const fees=parseFloat(document.getElementById('calc-fees').value)||0;
  const subPerAgent=parseInt(document.getElementById('calc-depth').value)||0;
  const rate=rates[product];
  const direct=agents*fees*rate;
  const networkAgents=agents*subPerAgent;
  const network=networkAgents*fees*rate;
  const total=direct+network;
  const fmt=n=>'$'+n.toLocaleString('en-US',{minimumFractionDigits:0,maximumFractionDigits:0});
  document.getElementById('calc-direct').textContent=fmt(direct);
  document.getElementById('calc-network').textContent=networkAgents>0?fmt(network)+' ('+networkAgents+' agents)':'$0';
  document.getElementById('calc-rate').textContent=(rate*100)+'%';
  document.getElementById('calc-total').textContent=fmt(total);
  document.getElementById('calc-annual').textContent=fmt(total*12);
}
['calc-agents','calc-product','calc-fees','calc-depth'].forEach(id=>document.getElementById(id).addEventListener('input',calcIncome));
calcIncome();

// Canvas
const canvas=document.getElementById('networkCanvas');
const ctx=canvas.getContext('2d');
let nodes=[],edges=[],W=0,H=420,frame=0;
const particles=[];

function buildNetwork(){
  W=canvas.offsetWidth||800; canvas.width=W; canvas.height=H;
  nodes=[]; edges=[];
  const hub={x:W/2,y:H/2,r:16,color:'#FAFAFA',label:'You',vx:0,vy:0,fixed:true};
  nodes.push(hub);
  const types=['casino','trading','wallet','domains'];
  const angles=[Math.PI*0.25,Math.PI*0.75,Math.PI*1.25,Math.PI*1.75];
  types.forEach((type,i)=>{
    const count=Math.min(nodeAgents[type],12);
    const mid=angles[i]; const dist=110+Math.random()*30;
    const tx=W/2+Math.cos(mid)*dist; const ty=H/2+Math.sin(mid)*dist;
    const th={x:tx,y:ty,r:9,color:COLORS[type],label:type,vx:(Math.random()-.5)*.2,vy:(Math.random()-.5)*.2};
    nodes.push(th);
    const thIdx=nodes.length-1;
    edges.push({a:0,b:thIdx,color:COLORS[type],alpha:.4});
    const spread=Math.PI/3;
    for(let j=0;j<count;j++){
      const la=mid-spread/2+(count>1?spread/(count-1)*j:0)+(Math.random()-.5)*.3;
      const ld=dist+55+Math.random()*55;
      const lx=W/2+Math.cos(la)*ld; const ly=H/2+Math.sin(la)*ld;
      const leaf={x:lx,y:ly,r:4+Math.random()*3,color:COLORS[type],vx:(Math.random()-.5)*.4,vy:(Math.random()-.5)*.4};
      nodes.push(leaf);
      edges.push({a:thIdx,b:nodes.length-1,color:COLORS[type],alpha:.18});
    }
  });
}

function spawnParticle(){
  if(!edges.length) return;
  const e=edges[Math.floor(Math.random()*edges.length)];
  particles.push({edge:e,t:0,speed:.004+Math.random()*.007});
}

function draw(){
  ctx.clearRect(0,0,W,H);
  edges.forEach(e=>{
    const a=nodes[e.a],b=nodes[e.b]; if(!a||!b) return;
    ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y);
    const hex=Math.round(e.alpha*255).toString(16).padStart(2,'0');
    ctx.strokeStyle=e.color+hex; ctx.lineWidth=1; ctx.stroke();
  });
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i]; p.t+=p.speed;
    if(p.t>1){particles.splice(i,1);continue;}
    const a=nodes[p.edge.a],b=nodes[p.edge.b];
    if(!a||!b){particles.splice(i,1);continue;}
    const px=a.x+(b.x-a.x)*p.t; const py=a.y+(b.y-a.y)*p.t;
    ctx.beginPath(); ctx.arc(px,py,2.5,0,Math.PI*2);
    ctx.fillStyle=p.edge.color; ctx.globalAlpha=1-p.t*.5; ctx.fill(); ctx.globalAlpha=1;
  }
  nodes.forEach((n,i)=>{
    const grd=ctx.createRadialGradient(n.x,n.y,0,n.x,n.y,n.r*2.5);
    grd.addColorStop(0,n.color+'40'); grd.addColorStop(1,'transparent');
    ctx.beginPath(); ctx.arc(n.x,n.y,n.r*2.5,0,Math.PI*2); ctx.fillStyle=grd; ctx.fill();
    ctx.beginPath(); ctx.arc(n.x,n.y,n.r,0,Math.PI*2); ctx.fillStyle=n.color; ctx.fill();
    if(n.label){ctx.fillStyle='#FAFAFA';ctx.font=i===0?'bold 11px Inter':'9px Inter';ctx.textAlign='center';ctx.fillText(n.label,n.x,n.y-n.r-4);}
  });
  nodes.forEach(n=>{
    if(n.fixed) return;
    n.x+=n.vx; n.y+=n.vy;
    if(n.x<15||n.x>W-15) n.vx*=-1;
    if(n.y<15||n.y>H-15) n.vy*=-1;
    n.vx*=.998; n.vy*=.998;
    n.vx+=(Math.random()-.5)*.018; n.vy+=(Math.random()-.5)*.018;
  });
  frame++; if(frame%7===0) spawnParticle();
  requestAnimationFrame(draw);
}

window.addEventListener('resize',buildNetwork);
buildNetwork(); draw(); loadData();
setInterval(loadData,30000);
</script>
</body>
</html>
