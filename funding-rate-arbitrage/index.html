<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Funding Rate Arbitrage for AI Agents â€” Automated Crypto Strategy</title>
<meta name="description" content="Complete guide to funding rate arbitrage with autonomous AI agents. Long spot + short perp strategy. Purple Flea Trading API code examples. 20% referral on trading fees.">
<link rel="canonical" href="https://purpleflea.com/funding-rate-arbitrage/">
<meta property="og:title" content="Funding Rate Arbitrage for AI Agents â€” Automated Crypto Strategy">
<meta property="og:description" content="Complete guide to funding rate arbitrage with autonomous AI agents. Long spot + short perp strategy. Purple Flea Trading API code examples. 20% referral on trading fees.">
<meta property="og:url" content="https://purpleflea.com/funding-rate-arbitrage/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Purple Flea">
<meta property="og:image" content="https://purpleflea.com/flea.jpg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@purpleflea">
<meta name="twitter:title" content="Funding Rate Arbitrage for AI Agents">
<meta name="twitter:description" content="Long spot + short perp. Collect funding while staying delta-neutral. Purple Flea Trading API code examples.">
<meta name="twitter:image" content="https://purpleflea.com/flea.jpg">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "Funding Rate Arbitrage for AI Agents",
  "url": "https://purpleflea.com/funding-rate-arbitrage/",
  "description": "Complete guide to funding rate arbitrage with autonomous AI agents. Long spot + short perp strategy with Purple Flea Trading API.",
  "publisher": {"@type": "Organization", "name": "Purple Flea", "url": "https://purpleflea.com"}
}
</script>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŸ£</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --purple: #A855F7;
  --purple-dim: #7C3AED;
  --purple-glow: rgba(168, 85, 247, 0.3);
  --purple-subtle: rgba(168, 85, 247, 0.08);
  --bg: #09090B;
  --bg-card: rgba(255, 255, 255, 0.03);
  --bg-card-hover: rgba(255, 255, 255, 0.06);
  --border: rgba(255, 255, 255, 0.06);
  --border-hover: rgba(168, 85, 247, 0.3);
  --text: #FAFAFA;
  --text-secondary: #A1A1AA;
  --text-muted: #71717A;
  --radius: 16px;
  --radius-sm: 10px;
}
html { scroll-behavior: smooth; }
body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; overflow-x: hidden; -webkit-font-smoothing: antialiased; }
body::before { content: ''; position: fixed; inset: 0; z-index: 9999; pointer-events: none; opacity: 0.025; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E"); background-repeat: repeat; background-size: 180px; }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(168, 85, 247, 0.3); border-radius: 3px; }
::selection { background: rgba(168, 85, 247, 0.4); color: white; }
.container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }
.reveal { opacity: 0; transform: translateY(30px); transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), transform 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
.reveal.visible { opacity: 1; transform: translateY(0); }
.reveal-delay-1 { transition-delay: 0.1s; }
.reveal-delay-2 { transition-delay: 0.2s; }
.reveal-delay-3 { transition-delay: 0.3s; }

/* NAV */
nav { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; padding: 16px 0; transition: all 0.3s ease; }
nav.scrolled { background: rgba(9, 9, 11, 0.8); backdrop-filter: blur(20px) saturate(1.5); border-bottom: 1px solid var(--border); }
.nav-inner { display: flex; align-items: center; justify-content: space-between; max-width: 1200px; margin: 0 auto; padding: 0 24px; }
.nav-logo { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 18px; text-decoration: none; color: var(--text); }
.nav-logo-icon { width: 32px; height: 32px; background: linear-gradient(135deg, var(--purple), var(--purple-dim)); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
.nav-links { display: flex; align-items: center; gap: 32px; list-style: none; }
.nav-links a { color: var(--text-secondary); text-decoration: none; font-size: 14px; font-weight: 450; transition: color 0.2s; }
.nav-links a:hover { color: var(--text); }
.nav-cta { display: inline-flex; align-items: center; gap: 6px; padding: 8px 18px; background: var(--purple); color: white !important; border-radius: 8px; font-weight: 500; font-size: 14px; text-decoration: none; transition: all 0.2s; }
.nav-cta:hover { background: var(--purple-dim); transform: translateY(-1px); }
@media (max-width: 768px) { .nav-links { display: none; } }

/* HERO */
.hero { min-height: 80vh; display: flex; align-items: center; justify-content: center; position: relative; padding: 120px 0 80px; overflow: hidden; }
.hero-bg { position: absolute; inset: 0; overflow: hidden; }
.hero-gradient-1 { position: absolute; top: -30%; left: 50%; transform: translateX(-50%); width: 900px; height: 600px; background: radial-gradient(ellipse, rgba(168, 85, 247, 0.15) 0%, transparent 70%); filter: blur(60px); }
.hero-grid { position: absolute; inset: 0; background-image: linear-gradient(rgba(168, 85, 247, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(168, 85, 247, 0.03) 1px, transparent 1px); background-size: 60px 60px; mask-image: radial-gradient(ellipse 60% 50% at 50% 50%, black 30%, transparent 100%); -webkit-mask-image: radial-gradient(ellipse 60% 50% at 50% 50%, black 30%, transparent 100%); }
.hero-content { position: relative; text-align: center; max-width: 860px; margin: 0 auto; padding: 0 24px; }
.hero-badge { display: inline-flex; align-items: center; gap: 8px; padding: 6px 16px 6px 8px; background: var(--purple-subtle); border: 1px solid rgba(168, 85, 247, 0.15); border-radius: 100px; font-size: 13px; font-weight: 500; color: var(--purple); margin-bottom: 32px; animation: fadeInDown 0.8s ease; }
.hero-badge-dot { width: 8px; height: 8px; background: var(--purple); border-radius: 50%; animation: badge-pulse 2s ease-in-out infinite; }
@keyframes badge-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
@keyframes fadeInDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes gradient-shift { 0% { background-position: 0% center; } 50% { background-position: 100% center; } 100% { background-position: 0% center; } }
.hero h1 { font-size: clamp(2.5rem, 6vw, 4.5rem); font-weight: 800; line-height: 1.05; letter-spacing: -0.03em; margin-bottom: 24px; animation: fadeInUp 0.8s ease 0.1s both; }
.hero h1 .gradient { background: linear-gradient(135deg, var(--purple) 0%, #C084FC 50%, var(--purple) 100%); background-size: 200% auto; -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; animation: gradient-shift 5s ease infinite; }
.hero-desc { font-size: clamp(1rem, 2vw, 1.2rem); color: var(--text-secondary); margin-bottom: 40px; line-height: 1.7; animation: fadeInUp 0.8s ease 0.2s both; }
.hero-actions { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; animation: fadeInUp 0.8s ease 0.3s both; }
.btn-primary { display: inline-flex; align-items: center; gap: 8px; padding: 14px 28px; background: var(--purple); color: white; border-radius: var(--radius-sm); font-weight: 600; font-size: 15px; text-decoration: none; transition: all 0.2s; box-shadow: 0 0 30px rgba(168, 85, 247, 0.3); }
.btn-primary:hover { background: var(--purple-dim); transform: translateY(-2px); box-shadow: 0 0 40px rgba(168, 85, 247, 0.5); }
.btn-secondary { display: inline-flex; align-items: center; gap: 8px; padding: 14px 28px; background: var(--bg-card); color: var(--text); border-radius: var(--radius-sm); font-weight: 500; font-size: 15px; text-decoration: none; border: 1px solid var(--border); transition: all 0.2s; }
.btn-secondary:hover { border-color: var(--border-hover); background: var(--bg-card-hover); transform: translateY(-2px); }

/* SECTIONS */
section { padding: 100px 0; position: relative; }
.section-label { display: inline-flex; align-items: center; gap: 12px; font-size: 12px; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; color: var(--purple); margin-bottom: 20px; }
.section-label::before { content: ''; width: 24px; height: 1px; background: var(--purple); }
.section-title { font-size: clamp(2rem, 4vw, 3rem); font-weight: 800; letter-spacing: -0.02em; margin-bottom: 20px; }
.section-desc { font-size: 1.1rem; color: var(--text-secondary); max-width: 700px; margin-bottom: 40px; line-height: 1.7; }
.section-divider { border: none; height: 1px; background: linear-gradient(90deg, transparent, var(--border), transparent); margin: 0; }

/* CODE BLOCK */
.code-block { background: rgba(0,0,0,0.4); border: 1px solid var(--border); border-radius: var(--radius); padding: 28px; font-family: 'JetBrains Mono', monospace; font-size: 13.5px; line-height: 1.7; overflow-x: auto; position: relative; }
.code-block .code-header { display: flex; align-items: center; gap: 8px; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.code-dot { width: 12px; height: 12px; border-radius: 50%; }
.code-dot.red { background: #EF4444; }
.code-dot.yellow { background: #FBBF24; }
.code-dot.green { background: #22C55E; }
.code-filename { margin-left: 8px; font-size: 12px; color: var(--text-muted); }
.kw { color: #C084FC; }
.fn { color: #93C5FD; }
.st { color: #86EFAC; }
.cm { color: var(--text-muted); font-style: italic; }
.num { color: #FDE68A; }
.cls { color: #F9A8D4; }
.at { color: #A855F7; }

/* GRID */
.grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
.grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
@media (max-width: 768px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } }

/* CARDS */
.card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 32px; transition: all 0.3s ease; }
.card:hover { background: var(--bg-card-hover); border-color: var(--border-hover); transform: translateY(-4px); box-shadow: 0 20px 60px rgba(0,0,0,0.4), 0 0 30px rgba(168,85,247,0.05); }
.card-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; margin-bottom: 20px; }
.card-icon.purple { background: rgba(168, 85, 247, 0.15); }
.card-icon.blue { background: rgba(96, 165, 250, 0.15); }
.card-icon.green { background: rgba(34, 197, 94, 0.15); }
.card-icon.orange { background: rgba(251, 146, 60, 0.15); }
.card-icon.red { background: rgba(239, 68, 68, 0.15); }
.card h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 10px; }
.card p { color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; }

/* STEPS */
.steps { display: flex; flex-direction: column; gap: 0; }
.step { display: flex; gap: 24px; padding: 32px 0; border-bottom: 1px solid var(--border); }
.step:last-child { border-bottom: none; }
.step-num { width: 40px; height: 40px; min-width: 40px; border-radius: 10px; background: var(--purple-subtle); border: 1px solid rgba(168,85,247,0.2); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; color: var(--purple); }
.step-content h3 { font-size: 1.05rem; font-weight: 600; margin-bottom: 8px; }
.step-content p { color: var(--text-secondary); font-size: 0.9rem; }

/* STAT BOXES */
.stat-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 48px; }
@media (max-width: 768px) { .stat-row { grid-template-columns: 1fr; } }
.stat-box { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 28px; text-align: center; }
.stat-box .stat-val { font-size: 2rem; font-weight: 800; color: var(--purple); letter-spacing: -0.02em; }
.stat-box .stat-label { font-size: 0.85rem; color: var(--text-muted); margin-top: 6px; }

/* PROSE */
.prose { max-width: 760px; }
.prose p { color: var(--text-secondary); font-size: 1rem; line-height: 1.8; margin-bottom: 20px; }
.prose h3 { font-size: 1.3rem; font-weight: 700; margin-bottom: 12px; margin-top: 40px; }
.prose ul { color: var(--text-secondary); font-size: 1rem; line-height: 1.8; margin-bottom: 20px; padding-left: 24px; }
.prose li { margin-bottom: 8px; }

/* CTA SECTION */
.cta-section { text-align: center; padding: 100px 0; }
.cta-box { background: linear-gradient(135deg, rgba(168,85,247,0.08) 0%, rgba(124,58,237,0.05) 100%); border: 1px solid rgba(168,85,247,0.2); border-radius: 24px; padding: 80px 40px; position: relative; overflow: hidden; }
.cta-box::before { content: ''; position: absolute; top: -50%; left: 50%; transform: translateX(-50%); width: 600px; height: 400px; background: radial-gradient(ellipse, rgba(168,85,247,0.1) 0%, transparent 70%); filter: blur(40px); pointer-events: none; }
.cta-box h2 { font-size: clamp(2rem, 4vw, 3rem); font-weight: 800; letter-spacing: -0.02em; margin-bottom: 20px; position: relative; }
.cta-box p { color: var(--text-secondary); font-size: 1.1rem; margin-bottom: 40px; position: relative; }

/* FOOTER */
footer { padding: 60px 0 40px; border-top: 1px solid var(--border); }
.footer-top { display: grid; grid-template-columns: 1fr 2fr; gap: 60px; margin-bottom: 60px; }
.footer-brand p { color: var(--text-secondary); font-size: 14px; margin-top: 16px; max-width: 260px; line-height: 1.6; }
.footer-columns { display: grid; grid-template-columns: repeat(3, 1fr); gap: 40px; }
.footer-col h4 { font-size: 13px; font-weight: 600; margin-bottom: 16px; }
.footer-col ul { list-style: none; display: flex; flex-direction: column; gap: 10px; }
.footer-col a { color: var(--text-muted); text-decoration: none; font-size: 13px; transition: color 0.2s; }
.footer-col a:hover { color: var(--text); }
.footer-bottom { display: flex; align-items: center; justify-content: space-between; padding-top: 24px; border-top: 1px solid var(--border); }
.footer-bottom p { color: var(--text-muted); font-size: 13px; }
.footer-social { display: flex; gap: 24px; }
.footer-social a { color: var(--text-muted); text-decoration: none; font-size: 13px; transition: color 0.2s; }
.footer-social a:hover { color: var(--text); }
@media (max-width: 768px) { .footer-top { grid-template-columns: 1fr; gap: 40px; } .footer-columns { grid-template-columns: repeat(2, 1fr); } .footer-bottom { flex-direction: column; gap: 16px; text-align: center; } }

/* RELATED LINKS */
.related-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
@media (max-width: 768px) { .related-grid { grid-template-columns: 1fr; } }
.related-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 20px 24px; text-decoration: none; color: var(--text); display: block; transition: all 0.2s; }
.related-card:hover { border-color: var(--border-hover); background: var(--bg-card-hover); transform: translateY(-2px); }
.related-card .label { font-size: 11px; color: var(--purple); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; }
.related-card .title { font-size: 14px; font-weight: 600; }
.related-card .desc { font-size: 13px; color: var(--text-muted); margin-top: 4px; }
</style>
</head>
<body>

<nav id="navbar">
  <div class="nav-inner">
    <a href="/" class="nav-logo">
      <div class="nav-logo-icon">&#9830;</div>
      Purple Flea
    </a>
    <ul class="nav-links">
      <li><a href="/docs">Docs</a></li>
      <li><a href="/for-agents">For Agents</a></li>
      <li><a href="/integrations">Integrations</a></li>
      <li><a href="/pricing">Pricing</a></li>
      <li><a href="https://wallet.purpleflea.com" target="_blank" class="nav-cta">Get Started &rarr;</a></li>
    </ul>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="hero-bg">
    <div class="hero-gradient-1"></div>
    <div class="hero-grid"></div>
  </div>
  <div class="hero-content">
    <div class="hero-badge">
      <div class="hero-badge-dot"></div>
      Delta-Neutral Strategy
    </div>
    <h1>Funding Rate Arbitrage<br>for <span class="gradient">AI Agents</span></h1>
    <p class="hero-desc">
      Perpetual futures markets pay funding every 8 hours. When rates are high, autonomous agents
      can go long spot and short the perpetual simultaneously â€” collecting yield while staying
      completely price-neutral. Here is how to build it with the Purple Flea Trading API.
    </p>
    <div class="hero-actions">
      <a href="https://wallet.purpleflea.com" class="btn-primary" target="_blank">Start Trading &rarr;</a>
      <a href="/trading-api/" class="btn-secondary">Trading API Docs</a>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- WHAT IS FUNDING RATE -->
<section>
  <div class="container">
    <div class="reveal">
      <div class="section-label">Fundamentals</div>
      <h2 class="section-title">What Is a Funding Rate?</h2>
      <div class="prose">
        <p>
          Perpetual futures are derivative contracts with no expiry date. Unlike quarterly futures,
          they can be held indefinitely â€” but they need a mechanism to keep their price anchored
          to the underlying spot market. That mechanism is the <strong style="color:var(--text)">funding rate</strong>.
        </p>
        <p>
          Every 8 hours, a payment is exchanged between longs and shorts. When the perpetual
          trades at a premium to spot (bullish sentiment), the funding rate is positive: longs
          pay shorts. When the perpetual trades at a discount (bearish sentiment), the rate is
          negative: shorts pay longs. This incentivizes traders to take the opposing side and
          pulls the perp price back toward spot.
        </p>
        <p>
          On ETH-PERP during a strong bull market, funding rates can reach 0.05%â€“0.10% per 8-hour
          interval â€” equivalent to 21%â€“44% annualized yield. That yield exists whether ETH goes
          up, down, or sideways. It is purely a structural payment from trend-followers to
          market-neutral traders.
        </p>
      </div>
    </div>

    <div class="stat-row reveal reveal-delay-1">
      <div class="stat-box">
        <div class="stat-val">0.01%</div>
        <div class="stat-label">Per 8h = 10.95% APY threshold to enter</div>
      </div>
      <div class="stat-box">
        <div class="stat-val">3x</div>
        <div class="stat-label">Daily funding payments (every 8 hours)</div>
      </div>
      <div class="stat-box">
        <div class="stat-val">275</div>
        <div class="stat-label">Perpetual markets to scan for opportunities</div>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- THE ARBITRAGE OPPORTUNITY -->
<section>
  <div class="container">
    <div class="reveal">
      <div class="section-label">The Strategy</div>
      <h2 class="section-title">The Arbitrage Opportunity</h2>
      <div class="prose">
        <p>
          When a perpetual's funding rate is significantly positive, there is a straightforward
          way to collect that yield without taking directional risk. The trade is:
        </p>
        <ul>
          <li>Buy 1 ETH on the spot market (or hold existing ETH)</li>
          <li>Short 1 ETH-PERP on Purple Flea at 1x leverage</li>
          <li>Net delta = 0. If ETH rises $100, your spot gains $100 and your short loses $100.</li>
          <li>Every 8 hours, longs pay you funding on your short position</li>
        </ul>
        <p>
          The result is a portfolio that earns yield from the structural imbalance between
          perpetual traders and the spot market, with zero directional exposure. This is classic
          cash-and-carry arbitrage adapted for perpetual futures.
        </p>
        <p>
          The strategy works best when funding is persistently positive â€” during sustained bull
          markets when leveraged longs dominate open interest. Your AI agent can monitor all
          275 markets on Purple Flea, identify the highest-yielding opportunity, and rotate
          automatically as rates shift.
        </p>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- IDENTIFYING OPPORTUNITIES -->
<section>
  <div class="container">
    <div class="reveal">
      <div class="section-label">Market Scanning</div>
      <h2 class="section-title">Identifying Opportunities</h2>
      <p class="section-desc">
        Fetch all 275 markets from the Purple Flea Trading API and sort by funding rate descending.
        Alert when any market exceeds your minimum APY threshold.
      </p>
    </div>

    <div class="reveal reveal-delay-1">
      <div class="code-block">
        <div class="code-header">
          <div class="code-dot red"></div>
          <div class="code-dot yellow"></div>
          <div class="code-dot green"></div>
          <span class="code-filename">scan_funding.py</span>
        </div>
<span class="kw">import</span> requests

API_KEY = <span class="st">"pf_sk_..."</span>
BASE_URL = <span class="st">"https://api.purpleflea.com"</span>
MIN_RATE_PER_8H = <span class="num">0.0001</span>  <span class="cm"># 0.01% = 10.95% APY</span>

<span class="kw">def</span> <span class="fn">get_funding_opportunities</span>():
    <span class="cm"># GET /trading/markets returns all 275 perpetual markets</span>
    resp = requests.<span class="fn">get</span>(
        <span class="st">f"{BASE_URL}/trading/markets"</span>,
        headers={<span class="st">"Authorization"</span>: <span class="st">f"Bearer {API_KEY}"</span>}
    )
    markets = resp.<span class="fn">json</span>()[<span class="st">"markets"</span>]

    <span class="cm"># Sort by funding_rate descending (highest yield first)</span>
    sorted_markets = <span class="fn">sorted</span>(
        markets,
        key=<span class="kw">lambda</span> m: m[<span class="st">"funding_rate"</span>],
        reverse=<span class="kw">True</span>
    )

    <span class="cm"># Filter to only actionable opportunities</span>
    opportunities = [
        m <span class="kw">for</span> m <span class="kw">in</span> sorted_markets
        <span class="kw">if</span> m[<span class="st">"funding_rate"</span>] > MIN_RATE_PER_8H
    ]

    <span class="kw">for</span> opp <span class="kw">in</span> opportunities[:<span class="num">5</span>]:
        annual_pct = opp[<span class="st">"funding_rate"</span>] * <span class="num">3</span> * <span class="num">365</span> * <span class="num">100</span>
        <span class="fn">print</span>(<span class="st">f"{opp['symbol']:15s}  rate={opp['funding_rate']:.4%}/8h  APY={annual_pct:.1f}%"</span>)

    <span class="kw">return</span> opportunities

<span class="cm"># Example output:</span>
<span class="cm"># ETH-PERP        rate=0.0510%/8h  APY=55.9%</span>
<span class="cm"># BTC-PERP        rate=0.0380%/8h  APY=41.6%</span>
<span class="cm"># SOL-PERP        rate=0.0210%/8h  APY=23.0%</span>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- THE TRADE -->
<section>
  <div class="container">
    <div class="reveal">
      <div class="section-label">Execution</div>
      <h2 class="section-title">The Trade, Step by Step</h2>
    </div>
    <div class="steps reveal reveal-delay-1">
      <div class="step">
        <div class="step-num">01</div>
        <div class="step-content">
          <h3>Acquire spot exposure</h3>
          <p>Buy 1 ETH on the spot market. You can use the Purple Flea Wallet API to swap USDC to ETH, or simply hold existing ETH. Your spot position is your hedge â€” it neutralizes the short's directional risk.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">02</div>
        <div class="step-content">
          <h3>Open a 1x short on ETH-PERP</h3>
          <p>Call <code style="font-family:'JetBrains Mono',monospace;color:var(--purple)">POST /trading/positions</code> with <code style="font-family:'JetBrains Mono',monospace">side: "short"</code>, <code style="font-family:'JetBrains Mono',monospace">leverage: 1</code>, and <code style="font-family:'JetBrains Mono',monospace">size: 1.0</code>. At 1x leverage your liquidation price is at $0 â€” you cannot be liquidated unless ETH goes to zero.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">03</div>
        <div class="step-content">
          <h3>Confirm delta neutrality</h3>
          <p>Net delta = long 1 ETH spot + short 1 ETH-PERP = 0. A $1,000 move in ETH price gains exactly $1,000 on spot and loses exactly $1,000 on the perp. You are market-neutral by construction.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">04</div>
        <div class="step-content">
          <h3>Collect funding every 8 hours</h3>
          <p>At 00:00, 08:00, and 16:00 UTC, the exchange credits funding to your short position. At 0.05%/8h on a $3,000 ETH position, that is $4.50 per payment, $13.50 per day, $4,927 per year â€” purely from structure.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">05</div>
        <div class="step-content">
          <h3>Monitor and exit when rate drops</h3>
          <p>Your agent polls funding rates hourly. When the rate falls below your minimum threshold (e.g., 0.005%/8h = 5.5% APY), close the short and sell spot. Rotate to the next highest-yielding market or hold cash.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- CODE IMPLEMENTATION -->
<section>
  <div class="container">
    <div class="reveal">
      <div class="section-label">Code Implementation</div>
      <h2 class="section-title">Full Python Agent</h2>
      <p class="section-desc">
        A complete autonomous funding rate agent that polls markets every hour, opens positions
        when rates exceed the threshold, and closes them when rates drop.
      </p>
    </div>

    <div class="reveal reveal-delay-1">
      <div class="code-block">
        <div class="code-header">
          <div class="code-dot red"></div>
          <div class="code-dot yellow"></div>
          <div class="code-dot green"></div>
          <span class="code-filename">funding_agent.py</span>
        </div>
<span class="kw">import</span> time, requests, logging
<span class="kw">from</span> datetime <span class="kw">import</span> datetime

logging.<span class="fn">basicConfig</span>(level=logging.INFO, format=<span class="st">"%(asctime)s %(message)s"</span>)

<span class="kw">class</span> <span class="cls">FundingRateAgent</span>:
    <span class="kw">def</span> <span class="fn">__init__</span>(self, api_key, min_rate=<span class="num">0.0001</span>, min_close_rate=<span class="num">0.00005</span>):
        self.api_key = api_key
        self.min_rate = min_rate          <span class="cm"># 0.01%/8h to open</span>
        self.min_close_rate = min_close_rate  <span class="cm"># 0.005%/8h to close</span>
        self.base = <span class="st">"https://api.purpleflea.com"</span>
        self.headers = {<span class="st">"Authorization"</span>: <span class="st">f"Bearer {api_key}"</span>}
        self.open_positions = {}  <span class="cm"># symbol -> {position_id, size, entry_rate}</span>
        self.total_funding_received = <span class="num">0.0</span>

    <span class="kw">def</span> <span class="fn">_get</span>(self, path):
        <span class="kw">return</span> requests.<span class="fn">get</span>(<span class="st">f"{self.base}{path}"</span>, headers=self.headers).<span class="fn">json</span>()

    <span class="kw">def</span> <span class="fn">_post</span>(self, path, data):
        <span class="kw">return</span> requests.<span class="fn">post</span>(<span class="st">f"{self.base}{path}"</span>, json=data, headers=self.headers).<span class="fn">json</span>()

    <span class="kw">def</span> <span class="fn">get_top_opportunities</span>(self, n=<span class="num">3</span>):
        markets = self.<span class="fn">_get</span>(<span class="st">"/trading/markets"</span>)[<span class="st">"markets"</span>]
        <span class="kw">return</span> <span class="fn">sorted</span>(markets, key=<span class="kw">lambda</span> m: m[<span class="st">"funding_rate"</span>], reverse=<span class="kw">True</span>)[:n]

    <span class="kw">def</span> <span class="fn">open_position</span>(self, symbol, size=<span class="num">1.0</span>):
        result = self.<span class="fn">_post</span>(<span class="st">"/trading/positions"</span>, {
            <span class="st">"symbol"</span>: symbol,
            <span class="st">"side"</span>: <span class="st">"short"</span>,
            <span class="st">"size"</span>: size,
            <span class="st">"leverage"</span>: <span class="num">1</span>,
            <span class="st">"order_type"</span>: <span class="st">"market"</span>,
        })
        self.open_positions[symbol] = {
            <span class="st">"position_id"</span>: result[<span class="st">"position_id"</span>],
            <span class="st">"size"</span>: size,
            <span class="st">"opened_at"</span>: <span class="fn">datetime</span>.utcnow().isoformat(),
        }
        logging.<span class="fn">info</span>(<span class="st">f"Opened short {size} {symbol} â†’ id={result['position_id']}"</span>)

    <span class="kw">def</span> <span class="fn">close_position</span>(self, symbol):
        pos = self.open_positions.<span class="fn">pop</span>(symbol, <span class="kw">None</span>)
        <span class="kw">if not</span> pos: <span class="kw">return</span>
        result = self.<span class="fn">_post</span>(<span class="st">f"/trading/positions/{pos['position_id']}/close"</span>, {})
        funding = result.<span class="fn">get</span>(<span class="st">"funding_received"</span>, <span class="num">0</span>)
        self.total_funding_received += funding
        logging.<span class="fn">info</span>(<span class="st">f"Closed {symbol} | funding received: ${funding:.4f} | total: ${self.total_funding_received:.4f}"</span>)

    <span class="kw">def</span> <span class="fn">run</span>(self, poll_interval_seconds=<span class="num">3600</span>):
        logging.<span class="fn">info</span>(<span class="st">"Funding rate agent started."</span>)
        <span class="kw">while True</span>:
            opportunities = self.<span class="fn">get_top_opportunities</span>()

            <span class="cm"># Open new positions where rate is above threshold</span>
            <span class="kw">for</span> opp <span class="kw">in</span> opportunities:
                symbol = opp[<span class="st">"symbol"</span>]
                rate = opp[<span class="st">"funding_rate"</span>]
                <span class="kw">if</span> rate > self.min_rate <span class="kw">and</span> symbol <span class="kw">not in</span> self.open_positions:
                    apy = rate * <span class="num">3</span> * <span class="num">365</span> * <span class="num">100</span>
                    logging.<span class="fn">info</span>(<span class="st">f"Opportunity: {symbol} rate={rate:.4%} APY={apy:.1f}%"</span>)
                    self.<span class="fn">open_position</span>(symbol)

            <span class="cm"># Close positions where rate has dropped below minimum</span>
            markets = {m[<span class="st">"symbol"</span>]: m <span class="kw">for</span> m <span class="kw">in</span> self.<span class="fn">_get</span>(<span class="st">"/trading/markets"</span>)[<span class="st">"markets"</span>]}
            <span class="kw">for</span> symbol <span class="kw">in</span> <span class="fn">list</span>(self.open_positions.keys()):
                current_rate = markets[symbol][<span class="st">"funding_rate"</span>]
                <span class="kw">if</span> current_rate < self.min_close_rate:
                    logging.<span class="fn">info</span>(<span class="st">f"Rate dropped on {symbol} ({current_rate:.4%}), closing."</span>)
                    self.<span class="fn">close_position</span>(symbol)

            time.<span class="fn">sleep</span>(poll_interval_seconds)

<span class="kw">if</span> __name__ == <span class="st">"__main__"</span>:
    agent = <span class="cls">FundingRateAgent</span>(api_key=<span class="st">"pf_sk_..."</span>)
    agent.<span class="fn">run</span>()
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- RISKS -->
<section>
  <div class="container">
    <div class="reveal">
      <div class="section-label">Risk Analysis</div>
      <h2 class="section-title">Risks to Understand</h2>
      <p class="section-desc">Funding rate arbitrage has a strong risk/reward profile, but it is not risk-free. Your agent must account for these factors.</p>
    </div>

    <div class="grid-2 reveal reveal-delay-1">
      <div class="card">
        <div class="card-icon red">&#8634;</div>
        <h3>Funding Rate Reversal</h3>
        <p>
          The most common risk. If sentiment flips bearish, funding goes negative and you
          are now paying â€” not receiving â€” funding on your short. Your agent must monitor
          rates continuously and close positions quickly when the rate turns negative.
          Set an auto-close webhook at any rate below zero.
        </p>
      </div>
      <div class="card">
        <div class="card-icon orange">&#9650;</div>
        <h3>Liquidation Risk on Short</h3>
        <p>
          At 1x leverage your liquidation price is effectively $0, making liquidation
          impossible in practice. But if you use higher leverage for more capital efficiency,
          a sharp price spike can approach your liquidation threshold before your agent
          can add margin. Always monitor the margin ratio via <code style="font-family:'JetBrains Mono',monospace;font-size:0.85em">GET /trading/positions</code>.
        </p>
      </div>
      <div class="card">
        <div class="card-icon blue">&#9651;</div>
        <h3>Gas and Transaction Costs</h3>
        <p>
          Entering and exiting the trade costs gas fees on the spot side. For small positions,
          these costs can negate days of funding income. Factor trading fees into your APY
          calculation before opening. Purple Flea charges 0.02% maker / 0.05% taker on perps.
        </p>
      </div>
      <div class="card">
        <div class="card-icon purple">&#9670;</div>
        <h3>Basis Risk</h3>
        <p>
          If the spot asset you hold (e.g., ETH via a liquid staking token) does not track
          the perp's underlying exactly, you have residual basis risk. Always use the same
          underlying for both legs. Hold raw ETH when shorting ETH-PERP for a perfect hedge.
        </p>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- RISK MANAGEMENT -->
<section>
  <div class="container">
    <div class="reveal">
      <div class="section-label">Risk Management</div>
      <h2 class="section-title">Keeping the Position Safe</h2>
    </div>
    <div class="grid-2" style="gap: 32px;">
      <div class="reveal reveal-delay-1">
        <div class="prose">
          <h3>Leverage and Liquidation</h3>
          <p>
            Keep your perpetual short at exactly 1x leverage. At 1x, your margin requirement
            equals the full notional value of the position. Your liquidation price is approximately
            2x your entry price â€” and since you simultaneously hold the spot asset, even if ETH
            doubled overnight, your spot gains cover the margin call. This structure means you can
            never be liquidated due to price movement alone.
          </p>
          <h3>Margin Ratio Monitoring</h3>
          <p>
            Poll <code style="font-family:'JetBrains Mono',monospace;color:var(--purple)">GET /trading/positions/{id}</code> hourly.
            The response includes <code style="font-family:'JetBrains Mono',monospace">margin_ratio</code> â€” the percentage
            of margin used. Set your agent to alert at 50% and auto-add margin at 70%.
            At 80%, trigger an emergency close.
          </p>
        </div>
      </div>
      <div class="reveal reveal-delay-2">
        <div class="code-block">
          <div class="code-header">
            <div class="code-dot red"></div>
            <div class="code-dot yellow"></div>
            <div class="code-dot green"></div>
            <span class="code-filename">risk_monitor.py</span>
          </div>
<span class="kw">def</span> <span class="fn">check_margin_health</span>(self):
    <span class="kw">for</span> symbol, pos <span class="kw">in</span> self.open_positions.<span class="fn">items</span>():
        data = self.<span class="fn">_get</span>(<span class="st">f"/trading/positions/{pos['position_id']}"</span>)
        margin_ratio = data[<span class="st">"margin_ratio"</span>]  <span class="cm"># 0.0 - 1.0</span>

        <span class="kw">if</span> margin_ratio > <span class="num">0.80</span>:
            logging.<span class="fn">warning</span>(<span class="st">f"EMERGENCY CLOSE {symbol}: margin={margin_ratio:.0%}"</span>)
            self.<span class="fn">close_position</span>(symbol)

        <span class="kw">elif</span> margin_ratio > <span class="num">0.70</span>:
            <span class="cm"># Add 20% more margin to bring ratio back down</span>
            extra = data[<span class="st">"notional_value"</span>] * <span class="num">0.20</span>
            self.<span class="fn">_post</span>(<span class="st">f"/trading/positions/{pos['position_id']}/margin"</span>, {
                <span class="st">"action"</span>: <span class="st">"add"</span>,
                <span class="st">"amount"</span>: extra
            })
            logging.<span class="fn">info</span>(<span class="st">f"Added ${extra:.2f} margin to {symbol}"</span>)

        <span class="kw">elif</span> margin_ratio > <span class="num">0.50</span>:
            logging.<span class="fn">warning</span>(<span class="st">f"Margin alert {symbol}: {margin_ratio:.0%} used"</span>)
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- EXPECTED RETURNS -->
<section>
  <div class="container">
    <div class="reveal">
      <div class="section-label">Performance</div>
      <h2 class="section-title">Expected Returns</h2>
      <div class="prose">
        <p>
          Historical funding rates on BTC and ETH perpetuals have averaged 10%â€“50% APY during
          sustained bull markets. In the 2020â€“2021 cycle, funding on BTC-PERP exceeded 100% APY
          for weeks at a time. In bear markets, rates often average near zero or slightly negative.
        </p>
        <p>
          A realistic expectation for a well-managed funding rate strategy is 15%â€“30% APY on
          the deployed capital over a full market cycle, with higher returns during bull phases
          and near-zero returns (but no losses) during bear phases when you stay out.
        </p>
      </div>
    </div>

    <div class="reveal reveal-delay-1">
      <div class="code-block">
        <div class="code-header">
          <div class="code-dot red"></div>
          <div class="code-dot yellow"></div>
          <div class="code-dot green"></div>
          <span class="code-filename">backtest.py</span>
        </div>
<span class="kw">def</span> <span class="fn">backtest_funding_strategy</span>(historical_rates, capital_usd, min_rate=<span class="num">0.0001</span>):
    <span class="st">"""
    historical_rates: list of dicts {timestamp, symbol, funding_rate}
    Returns simulated PnL assuming 1x short opened when rate > min_rate.
    """</span>
    pnl = <span class="num">0.0</span>
    in_position = <span class="kw">False</span>
    periods_active = <span class="num">0</span>
    periods_total = <span class="fn">len</span>(historical_rates)

    <span class="kw">for</span> period <span class="kw">in</span> historical_rates:
        rate = period[<span class="st">"funding_rate"</span>]

        <span class="kw">if not</span> in_position <span class="kw">and</span> rate > min_rate:
            in_position = <span class="kw">True</span>
            <span class="cm"># deduct entry cost (0.05% taker fee)</span>
            pnl -= capital_usd * <span class="num">0.0005</span>

        <span class="kw">if</span> in_position:
            <span class="kw">if</span> rate > <span class="num">0</span>:
                pnl += capital_usd * rate  <span class="cm"># collect funding</span>
                periods_active += <span class="num">1</span>
            <span class="kw">else</span>:
                <span class="cm"># rate flipped â€” close position</span>
                pnl -= capital_usd * <span class="num">0.0005</span>  <span class="cm"># exit fee</span>
                in_position = <span class="kw">False</span>

    utilization = periods_active / periods_total * <span class="num">100</span>
    apy = (pnl / capital_usd) * (periods_total / (periods_total / <span class="num">3</span> / <span class="num">365</span>)) * <span class="num">100</span>
    <span class="fn">print</span>(<span class="st">f"Net PnL: ${pnl:.2f} | Utilization: {utilization:.1f}% | Est. APY: {apy:.1f}%"</span>)
    <span class="kw">return</span> pnl
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<!-- RELATED -->
<section>
  <div class="container">
    <div class="reveal">
      <div class="section-label">Keep Reading</div>
      <h2 class="section-title">Related Strategies</h2>
    </div>
    <div class="related-grid reveal reveal-delay-1">
      <a href="/trading-api/" class="related-card">
        <div class="label">API Reference</div>
        <div class="title">Purple Flea Trading API</div>
        <div class="desc">Full docs for positions, markets, and margin</div>
      </a>
      <a href="/kelly-criterion-ai-trading/" class="related-card">
        <div class="label">Position Sizing</div>
        <div class="title">Kelly Criterion for AI Agents</div>
        <div class="desc">Optimal capital allocation across strategies</div>
      </a>
      <a href="/ai-trading-bot/" class="related-card">
        <div class="label">Strategy Guide</div>
        <div class="title">AI Trading Bot Blueprint</div>
        <div class="desc">End-to-end autonomous trading agent architecture</div>
      </a>
    </div>
  </div>
</section>

<!-- CTA -->
<section class="cta-section">
  <div class="container">
    <div class="cta-box reveal">
      <h2>Start collecting funding<br>with a <span style="color:var(--purple)">delta-neutral agent.</span></h2>
      <p>Free to start. 20% referral on all trading fees. No KYC required.</p>
      <div class="hero-actions">
        <a href="https://wallet.purpleflea.com" class="btn-primary" target="_blank">Register your agent &rarr;</a>
        <a href="/trading-api/" class="btn-secondary">Read the API docs</a>
      </div>
    </div>
  </div>
</section>

<hr class="section-divider">

<footer>
  <div class="container">
    <div class="footer-top">
      <div class="footer-brand">
        <a href="/" class="nav-logo">
          <div class="nav-logo-icon">&#9830;</div>
          Purple Flea
        </a>
        <p>AI-first infrastructure for autonomous agents. Built for machines, verified by math.</p>
      </div>
      <div class="footer-columns">
        <div class="footer-col">
          <h4>Products</h4>
          <ul>
            <li><a href="https://casino.purpleflea.com" target="_blank">Casino</a></li>
            <li><a href="https://trading.purpleflea.com" target="_blank">Trading</a></li>
            <li><a href="https://wallet.purpleflea.com" target="_blank">Wallet</a></li>
            <li><a href="https://domains.purpleflea.com" target="_blank">Domains</a></li>
            <li><a href="/crypto-wallet-api/">Wallet API Docs</a></li>
            <li><a href="/trading-api/">Trading API Docs</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Developers</h4>
          <ul>
            <li><a href="/docs">Docs</a></li>
            <li><a href="/for-agents">For Agents</a></li>
            <li><a href="/for-langchain/">LangChain</a></li>
            <li><a href="/for-crewai/">CrewAI</a></li>
            <li><a href="/for-claude/">Claude / MCP</a></li>
            <li><a href="/quick-start">Quick Start</a></li>
            <li><a href="/openapi">OpenAPI</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Company</h4>
          <ul>
            <li><a href="/pricing">Pricing</a></li>
            <li><a href="/stats">Stats</a></li>
            <li><a href="/changelog">Changelog</a></li>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="mailto:hello@purpleflea.com">Contact</a></li>
            <li><a href="https://github.com/Purple-flea" target="_blank">GitHub</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2026 Purple Flea. All rights reserved.</p>
      <div class="footer-social">
        <a href="https://github.com/Purple-flea" target="_blank">GitHub</a>
        <a href="https://x.com/purpleflea" target="_blank">X / Twitter</a>
      </div>
    </div>
  </div>
</footer>

<script>
const navbar = document.getElementById('navbar');
window.addEventListener('scroll', () => { navbar.classList.toggle('scrolled', window.scrollY > 50); });
const revealEls = document.querySelectorAll('.reveal');
const revealObs = new IntersectionObserver((entries) => {
  entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('visible'); revealObs.unobserve(e.target); } });
}, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });
revealEls.forEach(el => revealObs.observe(el));
</script>
</body>
</html>
