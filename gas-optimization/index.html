<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gas Optimization for AI Agents | Purple Flea</title>
  <meta name="description" content="Learn proven gas optimization strategies for AI agents operating on-chain. Batch transactions, time gas prices, choose the right L2, and reduce transaction costs by up to 100x.">
  <meta name="keywords" content="gas optimization, AI agents blockchain, on-chain AI, EIP-1559, L2 networks, Arbitrum, Optimism, Base, transaction costs, crypto gas fees">
  <meta name="author" content="Purple Flea">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://purpleflea.com/gas-optimization">

  <!-- Open Graph -->
  <meta property="og:type" content="article">
  <meta property="og:title" content="Gas Optimization for AI Agents | Purple Flea">
  <meta property="og:description" content="Learn proven gas optimization strategies for AI agents operating on-chain. Reduce transaction costs by up to 100x with batching, L2s, and smart gas pricing.">
  <meta property="og:url" content="https://purpleflea.com/gas-optimization">
  <meta property="og:site_name" content="Purple Flea">
  <meta property="og:image" content="https://purpleflea.com/og/gas-optimization.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@purplefleaapi">
  <meta name="twitter:title" content="Gas Optimization for AI Agents | Purple Flea">
  <meta name="twitter:description" content="Proven strategies to cut on-chain transaction costs for AI agents — batching, L2s, EIP-1559 tuning, and more.">
  <meta name="twitter:image" content="https://purpleflea.com/og/gas-optimization.png">

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "TechArticle",
    "headline": "Gas Optimization for AI Agents",
    "description": "A comprehensive guide to reducing on-chain transaction costs for AI agents through batching, L2 networks, EIP-1559 tuning, and smart gas pricing strategies.",
    "url": "https://purpleflea.com/gas-optimization",
    "author": {
      "@type": "Organization",
      "name": "Purple Flea",
      "url": "https://purpleflea.com"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Purple Flea",
      "url": "https://purpleflea.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://purpleflea.com/logo.png"
      }
    },
    "datePublished": "2026-02-27",
    "dateModified": "2026-02-27",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://purpleflea.com/gas-optimization"
    },
    "about": [
      {"@type": "Thing", "name": "Gas Optimization"},
      {"@type": "Thing", "name": "AI Agents"},
      {"@type": "Thing", "name": "Blockchain"},
      {"@type": "Thing", "name": "Layer 2 Networks"}
    ]
  }
  </script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --purple: #A855F7;
      --purple-dim: #7C3AED;
      --bg: #09090B;
      --text: #FAFAFA;
      --text-secondary: #A1A1AA;
      --text-muted: #71717A;
      --border: rgba(255,255,255,0.06);
      --bg-card: rgba(255,255,255,0.03);
      --radius: 16px;
      --radius-sm: 10px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    a { color: var(--purple); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* ── Nav ── */
    nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      background: rgba(9,9,11,0.85);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
    }

    .nav-logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      font-size: 1rem;
      color: var(--text);
      text-decoration: none;
    }

    .nav-logo span { font-size: 1.3rem; }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 28px;
      list-style: none;
    }

    .nav-links a {
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
      transition: color 0.15s;
    }

    .nav-links a:hover { color: var(--text); text-decoration: none; }

    .nav-cta {
      background: var(--purple);
      color: #fff !important;
      padding: 7px 18px;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 600;
      transition: background 0.15s, opacity 0.15s;
    }

    .nav-cta:hover { background: var(--purple-dim); opacity: 1; }

    /* ── Layout ── */
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 24px;
    }

    section { padding: 64px 0; }

    /* ── Hero ── */
    .hero {
      padding: 140px 0 72px;
      text-align: center;
    }

    .badge {
      display: inline-block;
      padding: 4px 14px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      background: rgba(168,85,247,0.12);
      color: var(--purple);
      border: 1px solid rgba(168,85,247,0.25);
      margin-bottom: 20px;
    }

    .hero h1 {
      font-size: clamp(2rem, 5vw, 3.25rem);
      font-weight: 700;
      line-height: 1.15;
      letter-spacing: -0.02em;
      margin-bottom: 20px;
    }

    .hero h1 em {
      font-style: normal;
      background: linear-gradient(135deg, var(--purple), #60A5FA);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero p {
      font-size: 1.125rem;
      color: var(--text-secondary);
      max-width: 580px;
      margin: 0 auto;
    }

    /* ── Section headings ── */
    .section-heading {
      font-size: 1.625rem;
      font-weight: 700;
      letter-spacing: -0.01em;
      margin-bottom: 12px;
    }

    .section-sub {
      color: var(--text-secondary);
      font-size: 1rem;
      margin-bottom: 40px;
    }

    /* ── Why gas matters ── */
    .why-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 32px;
    }

    .why-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
    }

    .why-card .stat {
      font-size: 2rem;
      font-weight: 700;
      color: var(--purple);
      font-family: 'JetBrains Mono', monospace;
      margin-bottom: 6px;
    }

    .why-card p {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    /* ── Strategy cards ── */
    .strategy-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      margin-top: 32px;
    }

    .strategy-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 28px 24px;
      transition: border-color 0.2s;
    }

    .strategy-card:hover { border-color: rgba(168,85,247,0.3); }

    .strategy-icon {
      width: 44px;
      height: 44px;
      border-radius: var(--radius-sm);
      background: rgba(168,85,247,0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      margin-bottom: 16px;
    }

    .strategy-card h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .strategy-card p {
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.65;
    }

    .strategy-card .tip {
      margin-top: 14px;
      padding: 10px 12px;
      background: rgba(168,85,247,0.07);
      border-left: 3px solid var(--purple);
      border-radius: 4px;
      font-size: 0.8125rem;
      color: var(--text-secondary);
    }

    /* ── Table ── */
    .table-wrapper {
      overflow-x: auto;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      margin-top: 32px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    thead th {
      padding: 14px 20px;
      text-align: left;
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--text-muted);
      background: rgba(255,255,255,0.02);
      border-bottom: 1px solid var(--border);
    }

    tbody td {
      padding: 14px 20px;
      border-bottom: 1px solid var(--border);
      color: var(--text-secondary);
      vertical-align: middle;
    }

    tbody tr:last-child td { border-bottom: none; }

    tbody tr:hover td { background: rgba(255,255,255,0.02); }

    .chain-name {
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .chain-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 600;
    }

    .badge-green { background: rgba(34,197,94,0.12); color: #4ADE80; border: 1px solid rgba(34,197,94,0.2); }
    .badge-blue  { background: rgba(96,165,250,0.12); color: #60A5FA; border: 1px solid rgba(96,165,250,0.2); }
    .badge-yellow { background: rgba(250,204,21,0.12); color: #FCD34D; border: 1px solid rgba(250,204,21,0.2); }

    .cost-cheap { color: #4ADE80; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; }
    .cost-mid   { color: #FCD34D; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; }
    .cost-high  { color: #F87171; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; }

    /* ── Purple Flea callout ── */
    .pf-callout {
      background: linear-gradient(135deg, rgba(168,85,247,0.08), rgba(96,165,250,0.05));
      border: 1px solid rgba(168,85,247,0.2);
      border-radius: var(--radius);
      padding: 36px 32px;
      margin-top: 32px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 24px;
      align-items: center;
    }

    .pf-callout h3 {
      font-size: 1.125rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .pf-callout p {
      font-size: 0.9375rem;
      color: var(--text-secondary);
      line-height: 1.7;
    }

    .pf-callout .pf-icon {
      font-size: 3rem;
      opacity: 0.8;
    }

    /* ── Code blocks ── */
    .code-section { background: none; }

    .code-block-wrap {
      margin-top: 32px;
      background: #0D0D10;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .code-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      background: rgba(255,255,255,0.02);
      border-bottom: 1px solid var(--border);
    }

    .code-header .lang-label {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .code-header .code-title {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    pre {
      padding: 24px;
      overflow-x: auto;
      margin: 0;
    }

    code {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8125rem;
      line-height: 1.75;
    }

    .kw  { color: #C084FC; }
    .fn  { color: #60A5FA; }
    .str { color: #86EFAC; }
    .num { color: #FCD34D; }
    .cm  { color: #52525B; font-style: italic; }
    .var { color: #F0ABFC; }
    .op  { color: #A1A1AA; }

    /* ── When gas matters ── */
    .when-list {
      margin-top: 28px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .when-item {
      display: flex;
      gap: 14px;
      align-items: flex-start;
      padding: 18px 20px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
    }

    .when-item .wi-icon {
      font-size: 1.2rem;
      margin-top: 1px;
      flex-shrink: 0;
    }

    .when-item h4 {
      font-size: 0.9375rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .when-item p {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    /* ── Final CTA ── */
    .cta-section {
      text-align: center;
      padding: 80px 0;
    }

    .cta-section h2 {
      font-size: clamp(1.5rem, 4vw, 2.25rem);
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 16px;
    }

    .cta-section p {
      color: var(--text-secondary);
      font-size: 1.0625rem;
      margin-bottom: 32px;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    .btn-primary {
      display: inline-block;
      background: var(--purple);
      color: #fff;
      font-weight: 600;
      font-size: 0.9375rem;
      padding: 13px 32px;
      border-radius: 10px;
      transition: background 0.15s, transform 0.1s;
    }

    .btn-primary:hover {
      background: var(--purple-dim);
      text-decoration: none;
      transform: translateY(-1px);
    }

    .btn-secondary {
      display: inline-block;
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 0.9375rem;
      padding: 13px 24px;
      border-radius: 10px;
      border: 1px solid var(--border);
      margin-left: 12px;
      transition: border-color 0.15s, color 0.15s;
    }

    .btn-secondary:hover {
      border-color: rgba(255,255,255,0.15);
      color: var(--text);
      text-decoration: none;
    }

    /* ── Divider ── */
    hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 0;
    }

    /* ── Footer ── */
    footer {
      padding: 36px 0;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.8125rem;
      border-top: 1px solid var(--border);
    }

    footer a { color: var(--text-muted); }
    footer a:hover { color: var(--text-secondary); }

    /* ── Responsive ── */
    @media (max-width: 680px) {
      .nav-links { display: none; }

      .hero { padding: 110px 0 56px; }

      .pf-callout {
        grid-template-columns: 1fr;
      }

      .pf-callout .pf-icon { display: none; }

      .btn-secondary { margin-left: 0; margin-top: 10px; }

      .cta-section .btn-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      .cta-section .btn-group .btn-secondary { margin: 0; }
    }
  </style>
</head>
<body>

<!-- ── Navigation ── -->
<nav>
  <a href="https://purpleflea.com" class="nav-logo">
    <span>&#x1F7E3;</span> Purple Flea
  </a>
  <ul class="nav-links">
    <li><a href="https://purpleflea.com/products">Products</a></li>
    <li><a href="https://purpleflea.com/docs">Docs</a></li>
    <li><a href="https://purpleflea.com/pricing">Pricing</a></li>
    <li><a href="https://purpleflea.com/blog">Blog</a></li>
    <li><a href="https://purpleflea.com/api-key" class="nav-cta">Get API Key</a></li>
  </ul>
</nav>

<!-- ── Hero ── -->
<div class="hero">
  <div class="container">
    <div class="badge">Guide</div>
    <h1>Gas Optimization<br>for <em>AI Agents</em></h1>
    <p>Every basis point counts when your agent executes hundreds of on-chain transactions per day. Learn how to cut transaction costs dramatically — or eliminate them entirely.</p>
  </div>
</div>

<hr>

<!-- ── Why Gas Matters ── -->
<section>
  <div class="container">
    <h2 class="section-heading">Why Gas Costs Destroy Agent Profitability</h2>
    <p class="section-sub">Unlike human traders who execute a few trades per day, AI agents can fire dozens or hundreds of transactions per hour. Gas adds up fast.</p>

    <div class="why-grid">
      <div class="why-card">
        <div class="stat">$3–15</div>
        <p>Typical Ethereum mainnet gas cost per swap or contract interaction, even during off-peak hours.</p>
      </div>
      <div class="why-card">
        <div class="stat">100x</div>
        <p>Cost reduction achievable by moving agent workloads from Ethereum mainnet to L2 networks like Base or Optimism.</p>
      </div>
      <div class="why-card">
        <div class="stat">30–50%</div>
        <p>Additional savings from batching multiple agent operations into a single transaction call.</p>
      </div>
      <div class="why-card">
        <div class="stat">~40%</div>
        <p>Lower gas costs during off-peak windows (weekend nights UTC) vs. peak weekday hours.</p>
      </div>
    </div>

    <p style="margin-top:28px; color: var(--text-secondary); font-size:0.9375rem;">
      An agent executing 50 trades per day on Ethereum mainnet at $5 average gas could burn <strong style="color:var(--text)">$9,125/year</strong> in gas alone — before any strategy losses. On Base, the same workload might cost <strong style="color:var(--text)">$30–90/year</strong>. Network and execution choices matter enormously for autonomous agent economics.
    </p>
  </div>
</section>

<hr>

<!-- ── Key Strategies ── -->
<section>
  <div class="container">
    <h2 class="section-heading">Key Optimization Strategies</h2>
    <p class="section-sub">These five techniques can be combined to dramatically reduce your agent's on-chain spend.</p>

    <div class="strategy-grid">

      <div class="strategy-card">
        <div class="strategy-icon">&#x1F4E6;</div>
        <h3>Batch Transactions</h3>
        <p>Instead of submitting five separate ERC-20 transfers or contract calls, pack them into a single multicall. Each transaction pays a flat 21,000 gas base fee — batching amortizes this across all operations.</p>
        <div class="tip">Use <code>Multicall3</code> (deployed on every major EVM chain at the same address) to bundle unlimited read/write calls into one transaction.</div>
      </div>

      <div class="strategy-card">
        <div class="strategy-icon">&#x23F0;</div>
        <h3>Gas Price Timing</h3>
        <p>Gas prices follow predictable weekly cycles. Ethereum mainnet is cheapest on Saturday and Sunday nights (UTC), often 40–60% below Monday morning peaks. Non-urgent agent tasks should queue for these windows.</p>
        <div class="tip">Monitor <a href="https://etherscan.io/gastracker" target="_blank" rel="noopener">Etherscan Gas Tracker</a> or use the <code>eth_gasPrice</code> RPC call to poll current basefee before submitting.</div>
      </div>

      <div class="strategy-card">
        <div class="strategy-icon">&#x26A1;</div>
        <h3>Use L2 Networks</h3>
        <p>Arbitrum, Optimism, and Base settle transactions on Ethereum but batch them off-chain, reducing costs by 100x or more. Solana offers sub-$0.001 transaction fees for ultra-high-frequency agents.</p>
        <div class="tip">For DeFi agents: most major protocols (Uniswap, Aave, Compound) are fully deployed on Arbitrum and Base with identical interfaces.</div>
      </div>

      <div class="strategy-card">
        <div class="strategy-icon">&#x1F4B0;</div>
        <h3>EIP-1559 Tip Tuning</h3>
        <p>Post-EIP-1559, transactions have two fee parameters. Setting them correctly avoids overpaying: the <code>baseFee</code> is burned and predictable, while <code>maxPriorityFeePerGas</code> is the validator tip.</p>
        <div class="tip">Set <code>maxPriorityFeePerGas</code> to 0.1–1 gwei for non-urgent transactions. Only increase it when your agent has time-sensitive trades (e.g., arbitrage).</div>
      </div>

      <div class="strategy-card">
        <div class="strategy-icon">&#x1F9EE;</div>
        <h3>Accurate Gas Estimation</h3>
        <p>Under-estimating gas causes transaction failures (wasting the base fee). Over-estimating locks up capital unnecessarily. Always call <code>eth_estimateGas</code> before submitting, then add a 20% safety buffer.</p>
        <div class="tip">For known contract interactions, cache the gas estimate from a recent successful call rather than estimating fresh every time — saves an extra RPC round-trip.</div>
      </div>

    </div>
  </div>
</section>

<hr>

<!-- ── Chain Comparison ── -->
<section>
  <div class="container">
    <h2 class="section-heading">Chain Cost Comparison</h2>
    <p class="section-sub">Choosing the right network is often the single highest-leverage gas optimization for an AI agent.</p>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Network</th>
            <th>Avg. Cost / Tx</th>
            <th>Finality</th>
            <th>Security Model</th>
            <th>Best For</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <div class="chain-name">
                Ethereum
                <span class="chain-badge badge-yellow">L1</span>
              </div>
            </td>
            <td class="cost-high">$3 – $15</td>
            <td>~12s</td>
            <td>Highest — full PoS</td>
            <td>High-value, infrequent ops</td>
          </tr>
          <tr>
            <td>
              <div class="chain-name">
                Arbitrum One
                <span class="chain-badge badge-blue">L2</span>
              </div>
            </td>
            <td class="cost-mid">$0.02 – $0.15</td>
            <td>~1s</td>
            <td>Optimistic rollup</td>
            <td>DeFi agents, high frequency</td>
          </tr>
          <tr>
            <td>
              <div class="chain-name">
                Optimism
                <span class="chain-badge badge-blue">L2</span>
              </div>
            </td>
            <td class="cost-mid">$0.01 – $0.10</td>
            <td>~2s</td>
            <td>Optimistic rollup</td>
            <td>General agent workloads</td>
          </tr>
          <tr>
            <td>
              <div class="chain-name">
                Base
                <span class="chain-badge badge-blue">L2</span>
              </div>
            </td>
            <td class="cost-cheap">$0.001 – $0.05</td>
            <td>~2s</td>
            <td>Optimistic rollup (OP Stack)</td>
            <td>High-volume agent ops</td>
          </tr>
          <tr>
            <td>
              <div class="chain-name">
                Solana
                <span class="chain-badge badge-green">Alt L1</span>
              </div>
            </td>
            <td class="cost-cheap">~$0.0001</td>
            <td>&lt;1s</td>
            <td>PoH + PoS</td>
            <td>Ultra-high-frequency agents</td>
          </tr>
        </tbody>
      </table>
    </div>

    <p style="margin-top: 16px; font-size: 0.8125rem; color: var(--text-muted);">
      Costs are approximate averages under normal network load. Congestion events (NFT mints, token launches) can spike fees significantly. Always check live gas trackers before deploying agent strategies.
    </p>
  </div>
</section>

<hr>

<!-- ── How Purple Flea Handles Gas ── -->
<section>
  <div class="container">
    <h2 class="section-heading">How Purple Flea Handles Gas</h2>
    <p class="section-sub">The short answer: you don't have to think about it.</p>

    <div class="pf-callout">
      <div>
        <h3>Gas is abstracted away in Purple Flea APIs</h3>
        <p>
          When your AI agent calls Purple Flea's swap, bridge, or yield APIs, it never submits raw transactions or manages wallets directly. Purple Flea's infrastructure handles all on-chain execution — including gas estimation, EIP-1559 parameter selection, network routing, and retry logic on congestion.
        </p>
        <p style="margin-top: 12px;">
          Your agent pays a flat USD-denominated API fee per operation. No ETH or SOL balance required. No failed transactions eating base fees. No gas spike surprises. The fee is predictable and billed to your Purple Flea account.
        </p>
        <p style="margin-top: 12px;">
          This architecture means your agent can focus entirely on strategy logic — when to act and what to do — while Purple Flea optimizes the <em>how</em> behind the scenes.
        </p>
      </div>
      <div class="pf-icon">&#x26BD;</div>
    </div>
  </div>
</section>

<hr>

<!-- ── Code Examples ── -->
<section class="code-section">
  <div class="container">
    <h2 class="section-heading">Code Examples</h2>
    <p class="section-sub">Practical patterns for gas-aware on-chain execution when you are managing transactions directly.</p>

    <!-- Example 1 -->
    <div class="code-block-wrap">
      <div class="code-header">
        <span class="code-title">Check current gas price before submitting</span>
        <span class="lang-label">JavaScript (ethers.js)</span>
      </div>
      <pre><code><span class="kw">import</span> { ethers } <span class="kw">from</span> <span class="str">'ethers'</span>;

<span class="kw">const</span> <span class="var">provider</span> <span class="op">=</span> <span class="kw">new</span> ethers.<span class="fn">JsonRpcProvider</span>(<span class="str">'https://mainnet.infura.io/v3/YOUR_KEY'</span>);

<span class="cm">// Fetch current EIP-1559 fee data</span>
<span class="kw">const</span> <span class="var">feeData</span> <span class="op">=</span> <span class="kw">await</span> <span class="var">provider</span>.<span class="fn">getFeeData</span>();

<span class="kw">const</span> <span class="var">baseFee</span>       <span class="op">=</span> <span class="var">feeData</span>.lastBaseFeePerGas;   <span class="cm">// current block baseFee</span>
<span class="kw">const</span> <span class="var">maxPriorityFee</span> <span class="op">=</span> ethers.<span class="fn">parseUnits</span>(<span class="str">'0.5'</span>, <span class="str">'gwei'</span>); <span class="cm">// tip: 0.5 gwei</span>

<span class="cm">// maxFeePerGas = 2x baseFee (buffer for next-block increase) + tip</span>
<span class="kw">const</span> <span class="var">maxFee</span> <span class="op">=</span> <span class="var">baseFee</span> <span class="op">*</span> <span class="num">2n</span> <span class="op">+</span> <span class="var">maxPriorityFee</span>;

<span class="cm">// Only proceed if gas is below threshold (10 gwei baseFee)</span>
<span class="kw">const</span> <span class="var">GAS_THRESHOLD</span> <span class="op">=</span> ethers.<span class="fn">parseUnits</span>(<span class="str">'10'</span>, <span class="str">'gwei'</span>);
<span class="kw">if</span> (<span class="var">baseFee</span> <span class="op">></span> <span class="var">GAS_THRESHOLD</span>) {
  console.<span class="fn">log</span>(<span class="str">'Gas too high, queuing for later...'</span>);
  <span class="kw">return</span>;
}

<span class="kw">const</span> <span class="var">tx</span> <span class="op">=</span> <span class="kw">await</span> <span class="var">wallet</span>.<span class="fn">sendTransaction</span>({
  to:                  <span class="var">contractAddress</span>,
  data:                <span class="var">calldata</span>,
  maxFeePerGas:        <span class="var">maxFee</span>,
  maxPriorityFeePerGas:<span class="var">maxPriorityFee</span>,
});</code></pre>
    </div>

    <!-- Example 2 -->
    <div class="code-block-wrap" style="margin-top: 20px;">
      <div class="code-header">
        <span class="code-title">Estimate gas with buffer before swap</span>
        <span class="lang-label">JavaScript (ethers.js)</span>
      </div>
      <pre><code><span class="kw">async function</span> <span class="fn">estimateWithBuffer</span>(<span class="var">contract</span>, <span class="var">method</span>, <span class="var">args</span>) {
  <span class="kw">const</span> <span class="var">rawEstimate</span> <span class="op">=</span> <span class="kw">await</span> <span class="var">contract</span>[<span class="var">method</span>].<span class="fn">estimateGas</span>(...<span class="var">args</span>);

  <span class="cm">// Add 20% buffer to avoid out-of-gas failures</span>
  <span class="kw">return</span> (<span class="var">rawEstimate</span> <span class="op">*</span> <span class="num">120n</span>) <span class="op">/</span> <span class="num">100n</span>;
}

<span class="cm">// Example: Uniswap V3 exactInputSingle swap</span>
<span class="kw">const</span> <span class="var">swapParams</span> <span class="op">=</span> {
  tokenIn:           <span class="var">WETH_ADDRESS</span>,
  tokenOut:          <span class="var">USDC_ADDRESS</span>,
  fee:               <span class="num">3000</span>,
  recipient:         <span class="var">wallet</span>.address,
  amountIn:          ethers.<span class="fn">parseEther</span>(<span class="str">'0.1'</span>),
  amountOutMinimum:  <span class="num">0n</span>,
  sqrtPriceLimitX96: <span class="num">0n</span>,
};

<span class="kw">const</span> <span class="var">gasLimit</span> <span class="op">=</span> <span class="kw">await</span> <span class="fn">estimateWithBuffer</span>(
  <span class="var">swapRouter</span>,
  <span class="str">'exactInputSingle'</span>,
  [<span class="var">swapParams</span>]
);

<span class="kw">const</span> <span class="var">receipt</span> <span class="op">=</span> <span class="kw">await</span> <span class="var">swapRouter</span>.<span class="fn">exactInputSingle</span>(<span class="var">swapParams</span>, { <span class="var">gasLimit</span> });
console.<span class="fn">log</span>(<span class="str">`Gas used: <span class="op">${</span><span class="var">receipt</span>.gasUsed<span class="op">}</span> / <span class="op">${</span><span class="var">gasLimit</span><span class="op">}</span>`</span>);</code></pre>
    </div>

    <!-- Example 3 -->
    <div class="code-block-wrap" style="margin-top: 20px;">
      <div class="code-header">
        <span class="code-title">Batch multiple transfers with Multicall3</span>
        <span class="lang-label">JavaScript (ethers.js)</span>
      </div>
      <pre><code><span class="cm">// Multicall3 is deployed at the same address on all major EVM chains</span>
<span class="kw">const</span> <span class="var">MULTICALL3</span> <span class="op">=</span> <span class="str">'0xcA11bde05977b3631167028862bE2a173976CA11'</span>;

<span class="kw">const</span> <span class="var">multicall</span> <span class="op">=</span> <span class="kw">new</span> ethers.<span class="fn">Contract</span>(<span class="var">MULTICALL3</span>, [
  <span class="str">'function aggregate3(tuple(address target, bool allowFailure, bytes callData)[] calls) payable returns (tuple(bool success, bytes returnData)[])'</span>
], <span class="var">wallet</span>);

<span class="cm">// Build calls for 3 separate ERC-20 transfers</span>
<span class="kw">const</span> <span class="var">iface</span> <span class="op">=</span> <span class="kw">new</span> ethers.<span class="fn">Interface</span>([
  <span class="str">'function transfer(address to, uint256 amount) returns (bool)'</span>
]);

<span class="kw">const</span> <span class="var">calls</span> <span class="op">=</span> <span class="var">recipients</span>.<span class="fn">map</span>(({ <span class="var">address</span>, <span class="var">amount</span> }) <span class="op">=></span> ({
  target:       <span class="var">TOKEN_ADDRESS</span>,
  allowFailure: <span class="kw">false</span>,
  callData:     <span class="var">iface</span>.<span class="fn">encodeFunctionData</span>(<span class="str">'transfer'</span>, [<span class="var">address</span>, <span class="var">amount</span>]),
}));

<span class="cm">// One transaction instead of three — one base fee, lower total gas</span>
<span class="kw">const</span> <span class="var">results</span> <span class="op">=</span> <span class="kw">await</span> <span class="var">multicall</span>.<span class="fn">aggregate3</span>(<span class="var">calls</span>);</code></pre>
    </div>

    <!-- Example 4: Purple Flea API -->
    <div class="code-block-wrap" style="margin-top: 20px;">
      <div class="code-header">
        <span class="code-title">The same swap via Purple Flea API — no gas management needed</span>
        <span class="lang-label">JavaScript (fetch)</span>
      </div>
      <pre><code><span class="cm">// No wallet. No gas estimation. No RPC node. Just an API call.</span>
<span class="kw">const</span> <span class="var">result</span> <span class="op">=</span> <span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">'https://api.purpleflea.com/v1/swap'</span>, {
  method:  <span class="str">'POST'</span>,
  headers: {
    <span class="str">'Authorization'</span>: <span class="str">`Bearer <span class="op">${</span><span class="var">PURPLEFLEA_API_KEY</span><span class="op">}</span>`</span>,
    <span class="str">'Content-Type'</span>:  <span class="str">'application/json'</span>,
  },
  body: JSON.<span class="fn">stringify</span>({
    fromToken: <span class="str">'ETH'</span>,
    toToken:   <span class="str">'USDC'</span>,
    amount:    <span class="str">'0.1'</span>,
    chain:     <span class="str">'base'</span>,      <span class="cm">// Purple Flea routes to cheapest execution</span>
    slippage:  <span class="num">0.5</span>,
  }),
}).<span class="fn">then</span>(<span class="var">r</span> <span class="op">=></span> <span class="var">r</span>.<span class="fn">json</span>());

<span class="cm">// You receive: { status: 'confirmed', txHash: '0x...', usdFee: 0.12 }</span>
<span class="cm">// Purple Flea paid the gas. You pay a flat USD fee.</span>
console.<span class="fn">log</span>(<span class="var">result</span>.status); <span class="cm">// 'confirmed'</span></code></pre>
    </div>
  </div>
</section>

<hr>

<!-- ── When Gas Matters Anyway ── -->
<section>
  <div class="container">
    <h2 class="section-heading">When Gas Still Matters</h2>
    <p class="section-sub">Even when using abstraction layers like Purple Flea, there are scenarios where your agent must manage gas directly.</p>

    <div class="when-list">
      <div class="when-item">
        <div class="wi-icon">&#x1F511;</div>
        <div>
          <h4>Self-Custody Operations</h4>
          <p>If your agent controls its own private key and submits transactions directly (for trustlessness or compliance reasons), it must manage gas itself. Use the EIP-1559 patterns above and a gas price oracle.</p>
        </div>
      </div>

      <div class="when-item">
        <div class="wi-icon">&#x1F4DC;</div>
        <div>
          <h4>Custom or Novel Smart Contracts</h4>
          <p>Interacting with a newly deployed or obscure contract not yet supported by API providers requires direct RPC calls. Always estimate gas and test on a fork before mainnet deployment.</p>
        </div>
      </div>

      <div class="when-item">
        <div class="wi-icon">&#x26A1;</div>
        <div>
          <h4>Latency-Critical Arbitrage</h4>
          <p>When your agent is competing against MEV bots for arbitrage opportunities, every millisecond and every gwei of tip matters. You may need to integrate with Flashbots Protect or a private mempool service to avoid front-running.</p>
        </div>
      </div>

      <div class="when-item">
        <div class="wi-icon">&#x1F3D7;&#xFE0F;</div>
        <div>
          <h4>On-Chain Agent Infrastructure</h4>
          <p>If your agent deploys or manages smart contracts (e.g., gnosis safes, on-chain logic modules), those deployment and admin transactions require direct gas management and should use testnets for iteration.</p>
        </div>
      </div>

      <div class="when-item">
        <div class="wi-icon">&#x1F310;</div>
        <div>
          <h4>Cross-Chain Bridging</h4>
          <p>Bridge transactions on the source chain require gas from the source network's native token. Plan your agent's native token balances across chains in advance, or use Purple Flea's bridge API to handle this automatically.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<hr>

<!-- ── Final CTA ── -->
<section class="cta-section">
  <div class="container">
    <h2>Skip the gas headaches.<br>Use Purple Flea APIs.</h2>
    <p>Let your AI agent focus on strategy while Purple Flea handles on-chain execution, gas optimization, and network routing — for a flat, predictable API fee.</p>
    <div class="btn-group">
      <a href="https://purpleflea.com/api-key" class="btn-primary">Get Your API Key</a>
      <a href="https://purpleflea.com/docs" class="btn-secondary">Read the Docs</a>
    </div>
  </div>
</section>

<!-- ── Footer ── -->
<footer>
  <div class="container">
    <p>&copy; 2026 Purple Flea &mdash; API Platform for AI Agents &nbsp;|&nbsp; <a href="https://purpleflea.com/privacy">Privacy</a> &nbsp;|&nbsp; <a href="https://purpleflea.com/terms">Terms</a> &nbsp;|&nbsp; <a href="https://purpleflea.com/docs">Docs</a></p>
  </div>
</footer>

</body>
</html>
